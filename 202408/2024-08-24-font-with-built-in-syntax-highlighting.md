# Font with Built-In Syntax Highlighting
- URL: https://blog.glyphdrawing.club/font-with-built-in-syntax-highlighting/
- Added At: 2024-08-24 11:32:33
- [Link To Text](2024-08-24-font-with-built-in-syntax-highlighting_raw.md)

## TL;DR
文章讨论了手工编码网站时遇到的语法高亮问题，提出了一种创新的解决方案：利用OpenType特性在字体中内置语法高亮。通过修改开源字体Monaspace Krypton并结合CSS实现高亮效果，无需JavaScript，简化了页面复杂性。尽管存在一些限制，如修改困难和依赖OpenType支持，但这种方法具有安装简单、快速、简洁等优点，未来可能通过更复杂的解析技术进一步改进。

## Summary
1. **背景介绍**：
   - 作者在Mastodon和Hacker News上讨论后，更新了字体，增加了更多示例和致谢。

2. **问题提出**：
   - **手工编码网站的困难**：手工编码网站（不依赖框架、生成器或第三方脚本）的实际困难。
   - **具体问题**：手工编码编程博客时，语法高亮是一个主要障碍。

3. **传统语法高亮方法**：
   - **复杂性**：使用Prism或highlight.js等库，通过扫描代码并分割成语言特定模式，然后注入HTML实现高亮。
   - **缺点**：增加页面复杂性和体积，不适合手工编码。

4. **创新解决方案**：
   - **字体内置语法高亮**：利用OpenType特性，通过创建彩色字形和上下文替代实现语法高亮。
   - **示例**：HTML代码片段中的颜色来自字体本身，无需JavaScript。

5. **实现方法**：
   - **字体修改**：修改开源字体Monaspace Krypton，包含彩色字符版本，并使用OpenType上下文替代进行文本替换。
   - **CSS集成**：通过CSS引入字体，实现语法高亮。

6. **优缺点分析**：
   - **优点**：
     1. 安装简单。
     2. 无需JavaScript。
     3. 无需CSS主题。
     4. 可主题化。
     5. 快速。
     6. 简洁的HTML源码。
     7. 支持OpenType的软件通用。
     8. 无需维护更新。
     9. 支持`<textarea>`和`<input>`。
   - **缺点**：
     1. 修改语法高亮需修改字体文件，对大多数人不可行。
     2. 仅在支持OpenType的软件中有效。
     3. OpenType上下文替代功能有限，不如正则表达式强大。

7. **技术细节**：
   - **OpenType COLR表**：实现多色字体。
   - **OpenType上下文替代**：通过查找和替换特定文本字符串实现语法高亮。
   - **JavaScript语法规则**：通过链式上下文替代实现关键词高亮。
   - **HTML & CSS语法规则**：通过复杂的查找规则实现高亮。
   - **未知长度规则**：使用有限状态机处理注释块和引号内字符串。

8. **未来展望**：
   - **潜在改进**：使用harfbuzz-wasm实现更复杂的解析，消除现有缺点。

9. **许可信息**：
   - 原始字体和修改版本遵循SIL开放字体许可证v1.1。
   - 代码示例遵循MIT许可证。

10. **更多示例**：
    - 展示了多种编程语言的关键词和语法高亮效果。

11. **致谢**：
    - 感谢Mastodon和Hacker News上的用户提供的反馈和建议。
