# 纯 Web 视频剪辑 | 风痕 · 術&思
- URL: https://hughfenghen.github.io/posts/2024/10/28/webav-video-editor/
- Added At: 2024-10-29 14:10:27
- [Link To Text](2024-10-29-纯-web-视频剪辑-风痕-·-術&思_raw.md)

## TL;DR
文章介绍了如何利用WebCodecs API在Web平台上实现视频剪辑，分析了不同实现方案的优缺点，并详细讲解了素材管理、画布、时间轴等模块的基础能力实现。强调了基础能力的重要性，并提供了相关资源供进一步学习。

## Summary
1. **前言**：
   - WebCodecs API为Web平台提供了音视频编解码能力，使得在Web平台（网页、Electron）上实现高效、专业的视频剪辑成品成为可能。
   - 读者可通过系列文章或直接使用WebAV开源项目在浏览器中创建/编辑音视频文件。

2. **背景与方案**：
   - 为了解决主播投稿场景中对直播视频进行简单编辑的需求，开发了一款轻量视频剪辑产品，让用户能在线上完成直播-编辑-投稿流程。
   - 现有Web平台的剪辑产品实现方案包括：
     - 云端：网页提供剪辑UI，用户操作同步到云端进行剪辑。
     - ffmpeg.wasm：将ffmpeg编译为wasm，在网页中剪辑。
     - WebCodecs：使用WebCodecs API编解码视频数据，配合Web API与第三方库实现剪辑。
   - 方案分析：
     - WebCodecs方案在成本与扩展性方面有明显优势，但生态成熟度和兼容性略显不足。
     - 云端方案是当前主流选择，适合项目成本预算充足的情况。
     - ffmpeg.wasm因性能太差，无法应用。

3. **功能分析**：
   - 开发一个剪辑产品只需三个步骤：
     1. 实现素材管理模块。
     2. 实现画布模块。
     3. 实现时间轴模块。
   - 每个模块下包含许多小功能，如素材管理、缩略图、预览播放，最终都可拆解成基础能力，基于Web平台提供的API实现。

4. **基础能力实现**：
   - **素材加载、存储**：
     - 音视频素材体积大，上传下载有时间、带宽成本。
     - 借助OPFS API，能较大提升用户体验。
   - **素材解析**：
     - 视频由一系列图片组成，原始数据量大，需压缩、封装成常见音视频文件。
     - 解析过程：视频文件 -> 解封装 -> 压缩帧 -> 解码 -> 原始图像帧。
   - **视频寻帧、遍历帧**：
     - 视频文件体积大，按需从磁盘读取数据然后解码。
     - 寻帧、流式遍历帧是音视频处理的第一步。
   - **图像处理**：
     - 简单图像处理通过Canvas API实现。
     - 复杂图像处理需配合WebGL Shader代码实现。
   - **空间、时间属性**：
     - 空间属性指素材的坐标、大小、旋转角度。
     - 时间属性指素材在视频中出现的时间偏移、持续时间。

5. **总结**：
   - 了解基础能力的原理，加上耐心与时间，能实现视频剪辑的大多数功能。
   - 基础能力还可应用于端上的视频批量处理、直播推流、播放能力增强等场景。
   - Web平台处理音视频有许多细节，需配合大量其他API，继续探索可阅读系列文章或使用开源的WebAV SDK。

6. **附录**：
   - 提供了多个相关文章和开源项目的链接，供进一步学习和使用。
