# curl source code age
- URL: https://daniel.haxx.se/blog/2024/10/31/curl-source-code-age/
- Added At: 2024-10-31 14:36:27

## TL;DR
作者通过编写脚本分析curl项目的代码年龄，使用gnuplot进行数据可视化，最终发现超过50%的代码是在2020年后编写的，约25%的代码在2014年前编写，1254行代码在2000年前编写。

## Summary
1. **研究动机**：
   - 在长期存在的软件项目中，代码有新有旧。
   - 作者好奇有多少旧代码在多年后仍然在使用。
   - 如何以可视化的方式展示这些数据。

2. **挑战**：
   - 作者决定将此作为本周的挑战。
   - 编写脚本遍历curl git仓库中的所有发布标签，提取相关源文件并运行`git blame`。
   - 使用`-t --line-porcelain`选项输出易于解析的结果。
   - 对每个发布标签的输出进行排序和统计，计算不同时间间隔内的代码行数。
   - 遍历数百个标签并运行`git blame`耗时超过一小时。

3. **数据可视化**：
   - 使用gnuplot将数据转换为可视化图表。
   - 需要实验`filledcurves`功能。

4. **可视化尝试**：
   - **第一次尝试**：按百分比划分代码年龄，难以解读。
   - **第二次尝试**：按两年为间隔划分代码年龄，标签移至右侧，图例移至图外，但无法显示代码行数的增长。
   - **第三次尝试**：基于实际行数进行可视化，更好地反映了代码行数的变化，但旧代码在图表上方显示可能不直观。
   - **第四次尝试**：将旧代码置于图表底部，新代码叠加其上，更好地展示了数据，图例移回图内。

5. **最终结果**：
   - 超过50%的curl代码是在2020年后编写的。
   - 约25%的代码是在2014年前编写的。
   - 近10%的代码是在2008年前编写的。
   - 1254行（0.64%）代码是在2000年前编写的。
   - 未与其他类似年龄的项目进行比较。

6. **脚本**：
   - 提供了`codeage.pl`和`codeage.plot`脚本，适用于分析自己的git仓库，但需调整curl特定的假设。
