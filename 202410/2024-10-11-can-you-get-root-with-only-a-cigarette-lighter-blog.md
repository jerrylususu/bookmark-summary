# Can You Get Root With Only a Cigarette Lighter? | Blog
- URL: https://www.da.vidbuchanan.co.uk/blog/dram-emfi.html
- Added At: 2024-10-11 15:02:39
- [Link To Text](2024-10-11-can-you-get-root-with-only-a-cigarette-lighter-blog_raw.md)

## TL;DR
文章探讨了使用低成本工具如打火机进行硬件故障注入（EMFI）以获取Root权限的可能性，并通过实验验证了这一方法。作者成功利用打火机诱导内存错误，实现了CPython和Linux系统的漏洞利用，展示了其在游戏反作弊和Android设备安全检查绕过中的潜在应用。

## Summary
1. **概述**：
   - **标题**：“你能只用一个打火机获得Root权限吗？”
   - **作者**：David Buchanan，2024年10月7日
   - **结论**：是的，可以通过硬件故障注入（EMFI）实现。

2. **故障注入简介**：
   - **方法**：包括软件控制的数据损坏、电源干扰、时钟干扰、电磁脉冲、激光等。
   - **硬件故障注入**：通常需要专业且昂贵的设备，因为需要高精度控制故障注入的时间和位置。

3. **低成本EMFI工具**：
   - **BBQ点火器**：使用压电点火器结合电感器作为低成本的电磁故障注入工具。
   - **实验**：通过焊接电线到DDR3 SODIMM的数据线（DQ26），利用打火机在附近点击，成功诱导内存错误。

4. **实验设备**：
   - **测试对象**：一台三星S3520笔记本电脑，配备Intel i3-2310M CPU和1GB DDR3 RAM。
   - **目标**：编写基于注入硬件故障的本地权限提升漏洞。

5. **CPython漏洞利用**：
   - **策略**：在CPython中创建一个包含伪造`bytearray`结构的`bytes`对象，通过故障注入将指针转换为伪造对象的指针，实现任意内存读写。
   - **实现**：通过焊接电线到DQ7，利用打火机点击诱导内存错误，成功实现沙盒逃逸。

6. **Linux漏洞利用**：
   - **核心概念**：内存缓存、虚拟内存和页表、翻译后备缓冲区（TLB）。
   - **策略**：通过填充物理内存的50%空间为0级页表，利用故障注入修改页表项（PTE），使其指向用户可访问的页表，从而获得任意物理内存访问权限。
   - **实现**：通过memfd和mmap系统调用创建大量映射，循环访问映射以触发页表遍历，利用打火机点击诱导故障，成功实现本地权限提升。

7. **实际应用**：
   - **游戏反作弊**：可能用于绕过基于TPM的反作弊软件。
   - **Android设备**：可能用于绕过SafetyNet/Play Integrity检查。

8. **未来研究方向**：
   - **内存类型**：是否适用于DDR4、DDR5和ARM架构。
   - **ECC保护**：各种类型的ECC如何缓解此类攻击。
   - **电子触发**：使用RP2040等设备触发类似故障的最简单方法。
   - **其他应用**：是否可以用于逃逸虚拟机、编写Webkit漏洞、Nintendo Switch内核漏洞。

9. **总结**：
   - **个人感受**：通过实际操作页表和TLB，感觉像是逃离了“矩阵”，验证了理论知识的实际应用。
   - **感谢**：感谢JEDEC对相关规范文档的付费墙设置，增加了研究的挑战性。
