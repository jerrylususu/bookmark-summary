# Conflating Overture Places Using DuckDB, Ollama, Embeddings, and More
- URL: https://www.dbreunig.com/2024/09/27/conflating-overture-points-of-interests-with-duckdb-ollama-and-more.html
- Added At: 2024-10-01 03:46:44

## TL;DR
文章讨论了地理空间数据合并的挑战，介绍了使用DuckDB、Ollama和Python在本地机器上合并阿拉米达县餐厅检查数据与Overture Maps地点数据的方法。通过H3瓦片分组和多步骤合并管道（包括精确名称匹配、字符串相似度和嵌入模型），显著提高了数据匹配率。嵌入模型因其易用性和高效性被推荐为合并工具，未来可进一步优化。

## Summary
1. **引言**：
   - **地理空间数据合并的挑战**：地理空间工作中的一个棘手问题是数据合并（conflation），即将描述同一现实特征的多个数据源进行合并和集成。
   - **数据集的复杂性**：数据集描述特征不一致且常含错误，合并过程复杂，涉及多个阶段、条件和比较方法，有时需要人工审查和解决最顽固的连接问题。

2. **工具与数据**：
   - **当前工具的黄金时代**：现在可以使用免费且易于使用的工具在笔记本电脑上快速组装和分析地理数据，无需复杂的数据准备、专用数据库或地图投影处理。
   - **大语言模型（LLMs）的影响**：LLMs带来了开放的嵌入模型，可以评估文本、图像等的上下文相似性，为数据合并提供了新的工具。

3. **项目目标**：
   - **数据合并示例**：尝试将阿拉米达县的餐厅检查数据与Overture Maps Foundation的地点数据进行合并，以便按当前检查分数对餐厅进行可视化和排序。
   - **本地处理**：所有操作将在本地机器上完成，使用DuckDB、Ollama和Python。

4. **数据准备**：
   - **获取数据**：从阿拉米达县的数据网站下载餐厅检查记录的CSV文件，并使用DuckDB加载和处理数据。
   - **获取Overture数据**：计算包含检查记录的边界框，从Overture下载相关地点数据，并进行数据转换以匹配检查记录。

5. **生成H3瓦片**：
   - **使用H3进行区域分组**：使用H3瓦片系统对地点进行预分组，以便在合并过程中减少不必要的比较。

6. **合并方法**：
   - **方法1：精确名称匹配**：通过名称完全匹配在同一H3瓦片内的地点，匹配了930个设施，但存在地址不一致的问题。
   - **方法2：字符串相似度**：使用Jaro-Winkler距离函数进行字符串相似度比较，通过调整相似度阈值，提高了匹配率至70%。
   - **方法3：嵌入模型**：使用Ollama生成地点的嵌入向量，通过比较嵌入向量的相似度进行匹配，显著提高了匹配率，且匹配过程简单。

7. **总结与展望**：
   - **多步骤合并管道**：建议使用多步骤的合并管道，首先使用字符串相似度匹配，然后对剩余的记录使用嵌入模型匹配。
   - **嵌入模型的优势**：嵌入模型易于部署，能够捕捉复杂的相似性，且在初次设置后使用方便。
   - **未来改进**：可以进一步优化嵌入模型的选择和使用，以及探索DuckDB的向量相似性搜索扩展。

8. **结论**：
   - **本地处理的便利性**：所有操作均在本地机器上完成，使用DuckDB、Ollama、H3等工具，减少了地理空间处理的复杂性。
