# Performance measurements… and the people who love them
- URL: https://blog.cloudflare.com/loving-performance-measurements/
- Added At: 2025-05-20 14:19:00
- [Link To Text](2025-05-20-performance-measurements…-and-the-people-who-love-them_raw.md)

## TL;DR


本文探讨网络性能测量挑战，指出传统分位数统计易忽视尾部延迟，用户真实体验需关注多请求场景下的高分位数（如99.99%）。Cloudflare提出通过CDF和QQ图更精准呈现延迟分布，并强调优化尾部延迟是核心优势，计划推出新工具分析真实用户体验。

## Summary


- **性能测量的挑战**：准确性、精确性和数据聚合是关键问题。高采样率可能导致数据过载，而仅依赖聚合后的分位数（如p50、p99）可能掩盖系统的真实延迟分布。Cloudflare作为服务端，无法直接测量客户端端到端延迟，需依赖估算。

- **延迟的定义与视角**：延迟从客户端视角定义，即请求发起到完成的时间差。Cloudflare内部指标（如缓存层延迟、远端延迟）仅为局部观测，需排除自身不相关的阶段（如DNS查询、本地TLS计算）。

- **TTFB的复杂性**：首字节时间（TTFB）的定义模糊且存在歧义，不同工具（如浏览器、监测平台Catchpoint）的测量阶段不同。Catchpoint的TTFB包含DNS、连接、TLS和等待时间，但需注意其定义不等同于浏览器标准。

- **统计聚合的局限性**：分位数可视化易忽略尾部延迟。例如，某时段Cloudflare的p99延迟激增1300%，但若仅关注最大值（p100），则波动不显著。尾部1%请求占系统总延迟的99%，忽略可能误导决策。

- **多请求对用户体验的影响**：用户访问网页通常需数十甚至数百个请求。假设[www.cloudflare.com]平均70个请求，若要确保用户无任意单请求超过50th分位延迟，需关注99.99th分位的延迟，而非仅平均或中间值。

- **可视化工具的革新**：通过CDF（累积分布函数）和QQ-Plot，可更完整展示延迟分布。案例显示，某CDN在p99以下分位数优于Cloudflare，但在高分位数（如99.99th）时Cloudflare更快。结合180个请求，用户实际体验中Cloudflare的期望延迟反而更低（相差71.9ms）。

- **未来工具与方法**：Cloudflare将推出更精确的分析工具，帮助客户理解真实用户体验的延迟分布，并强调尾部延迟优化的重要性，计划在2025年公开更多详情。

- **关键洞见**：单纯关注单个请求的低分位数可能导致误判，需结合多请求场景分析高分位数延迟，才能反映用户整体体验。可靠性与尾部延迟控制是Cloudflare的核心优势。
