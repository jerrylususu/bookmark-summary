Title: è½»é‡çº§åœ°å…‹éš†ä¸€ä¸ª Git ä»“åº“

URL Source: https://hedzr.com/devops/git/lite-clone-a-git-repo/

Published Time: 2025-05-21T05:00:00+08:00

Markdown Content:
Git Clone çš„å¤šç§æ–¹æ³•[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#git-clone-%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%B9%E6%B3%95 "Permalink")
---------------------------------------------------------------------------------------------------------------------------------------------------

æŒ‰ç…§ä¸‹è½½é‡çš„å¤§å°ä»¥åŠ repo çš„å®Œæ•´ç¨‹åº¦ï¼ŒGit Clone å®é™…ä¸Šæœ‰å¾ˆå¤šç§æ–¹æ³•ã€‚ä¸‹é¢ä¾æ¬¡åˆ—ä¸¾ä¸€ä¸‹ã€‚

### Normal Clone[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#normal-clone "Permalink")

ä¼ ç»Ÿçš„ Clone å–å›è¿œç¨‹ä»“åº“çš„ä¸€åˆ‡å†…å®¹ã€‚è¿™ç§æ–¹æ³•é€šå¸¸è¢«ä½¿ç”¨ï¼Œä¸‹è½½é‡ä¹Ÿæ˜¯æœ€å¤§çš„ã€‚

ä»¥ LLVM é¡¹ç›®çš„æºç ä»“åº“è€Œè¨€ï¼Œå½“å‰çš„å…¨ä»“å°ºå¯¸å¤§çº¦ 4.3GB ä¸Šä¸‹ï¼ˆå…¶ä¸­ `.git` ç›®å½•çš„æœ¬åœ°ç£ç›˜ç©ºé—´å ç”¨ä¸º 2.2GBå·¦å³ï¼Œworking directory æœ¬ä½“å¤§çº¦ 2.1GB çš„æ ·å­ï¼‰ï¼Œä¸€æ¬¡å®Œæ•´çš„æ ‡å‡† Clone å¦‚ä¸‹ï¼š

```
1
2
3
4
5
6
7
8
9
10
11
12
13
$ git clone https://github.com/llvm/llvm-project
Cloning into 'llvm-project'...
remote: Enumerating objects: 6540723, done.
remote: Counting objects: 100% (4544/4544), done.
remote: Compressing objects: 100% (1492/1492), done.
remote: Total 6540723 (delta 3982), reused 3053 (delta 3052), pack-reused 6536179 (from 3)
Receiving objects: 100% (6540723/6540723), 2.02 GiB | 3.16 MiB/s, done.
Resolving deltas: 100% (5417295/5417295), done.
Updating files: 100% (157588/157588), done.
$ du -sh llvm-project llvm-project/.git
4.3G	llvm-project
2.2G	llvm-project/.git
$
```

è¿™æ˜¾ç„¶è¿˜æ˜¯å¾ˆæœ‰å‹åŠ›çš„ã€‚

å¦‚æœä½ çš„é•œåƒé€‰å–çš„ä¸å¥½ï¼Œé‚£ä¹ˆé‡åˆ° EOF é”™è¯¯çš„å‡ ç‡ç›¸å½“é«˜ï¼Œç”±äº git clone ä¸èƒ½æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆè¿™æ¯•ç«Ÿä¸æ˜¯å•ä¸€å¯¹è±¡ï¼Œ`.git` ä¸‹é¢çš„æ•°æ®å¯¹è±¡ï¼ˆblobï¼‰å®é™…ä¸Šæ˜¯ä»¥æ•°æ®åº“è®°å½•çš„å½¢æ€ç»„ç»‡çš„ï¼‰ï¼Œæ‰€ä»¥æ¯æ¬¡ EOF éƒ½ä¼šå¯¼è‡´æ•´ä¸ª clone è¿‡ç¨‹é‡å¯ï¼Œå¯¹äºåƒ linux-project, llvm-project ç­‰ç­‰è¿™æ ·çš„å¤§ä»“åº“æ¥è¯´ï¼Œå®Œæˆé¦–æ¬¡ clone å‡ ä¹æˆä¸ºä¸å¯èƒ½çš„äº‹æƒ…ã€‚

`.git` ä¸­å­˜å‚¨çš„å†…å®¹å¯ä»¥è¢«åˆ’åˆ†ä¸º blob, index ç­‰ç­‰å‡ å¤§ç±»ï¼Œæˆ‘ä»¬å·²ç»æåŠè¿™äº›å†…å®¹å®é™…ä¸Šæ„æˆäº†ä¸€ä¸ªæ•°æ®åº“ï¼Œgit æäº¤å†å²æ‰€å½¢æˆçš„ç‰ˆæœ¬è®°å½•å®é™…ä¸Šè¢«æ˜ å°„ä¸ºæ•°æ®åº“çš„è¡¨è®°å½•ã€‚

æ‰€ä»¥å½“ä½ éœ€è¦å®Œæ•´çš„æ•°æ®åº“çš„æ—¶å€™ï¼Œå„æ–¹é¢çš„å‹åŠ›å‡æ— æ³•è½»æ˜“é‡Šæ”¾ã€‚

### Shallow Clone[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#shallow-clone "Permalink")

æ‰€ä»¥æœ€å…¸å‹çš„è½»é‡çº§å…‹éš†æ–¹æ³•æ˜¯ `Shallow Clone`ã€‚

è¿™ç§æ–¹æ³•çš„ç‰¹ç‚¹æ˜¯ä»…ä¸‹æ‹‰ç»™å®š refspec ï¼ˆé€šå¸¸ä¸º `HEAD`ï¼‰çš„ç›¸å…³è®°å½•ï¼Œè€Œæ”¾å¼ƒä¸€åˆ‡çš„å…¶å®ƒ branchesï¼ˆä»¥åŠ tagsï¼‰ã€‚

å¯¹äºé‚£ç§åˆ†æ”¯å’Œ release tags å¥‡å¤šçš„å¤§ä»“åº“æ¥è¯´ï¼ŒShallow Clone çš„æ•ˆæœç«‹ç«¿è§å½±ï¼Œèƒ½å¤Ÿæ˜¾è‘—é™ä½ä¸‹è½½é‡ã€‚

åŒæ ·ä»¥ LLVM ä¸ºä¾‹ï¼š

```
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
$ git clone --depth=1 https://github.com/llvm/llvm-project llvm-project-shallowed
Cloning into 'llvm-project-shallowed'...
remote: Enumerating objects: 165365, done.
remote: Counting objects: 100% (165365/165365), done.
remote: Compressing objects: 100% (139258/139258), done.
remote: Total 165365 (delta 36896), reused 61531 (delta 21641), pack-reused 0 (from 0)
Receiving objects: 100% (165365/165365), 243.62 MiB | 6.37 MiB/s, done.
Resolving deltas: 100% (36896/36896), done.
Updating files: 100% (157588/157588), done.

$ du -sh llvm-project-shallowed llvm-project-shallowed/.git
2.3G	llvm-project-shallowed
280M	llvm-project-shallowed/.git

$
```

å°½ç®¡æˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸‹è½½é‡çš„ç»å¯¹å€¼ä¾ç„¶ä¸å°ï¼ˆæ€»ä½“å¤§çº¦ 280MBï¼‰ï¼Œä½†è¿™æ¯”å…¨ä»“ä¸‹è½½çš„ 2.2GB å·²ç»æ˜¯å·¨å¤§çš„æ”¹å–„äº†ï¼Œç²—ç•¥è€Œè®ºçš„è¯å·²ç»æé€Ÿäº†åå€ã€‚

ç›¸å¯¹äºå¾ˆå¤šä»£ç ä»“åº“çš„ 5MB æˆ–è€…æ•°å MB è€Œè¨€ï¼Œ280MB å¯ä»¥ç®—æ˜¯ä¸€ä¸ªå¤§æ•°å€¼äº†ã€‚

æ³¨æ„ï¼Œå•è®ºä¸‹è½½é‡çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ `.git` æ–‡ä»¶å¤¹çš„å°ºå¯¸å³å¯ï¼Œå› ä¸º working directory ä¸­çš„æ–‡ä»¶éƒ½æ˜¯é€šè¿‡ä» `.git` è®°å½•ä¸­è§£åŒ…è€Œå¾—æ¥ï¼Œå¹¶ä¸è¢«è®¡ç®—åœ¨ä¸‹è½½é‡ä¸­ã€‚

#### Unshallow[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#unshallow "Permalink")

å½“å®Œæˆäº†æµ…å…‹éš†ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå•å±‚çš„æœ¬åœ°ä»“åº“ï¼Œå•å±‚è¡¨ç¤ºæäº¤è®°å½•ï¼ŒTree è®°å½•ï¼Œéƒ½åªæœ‰å•ä¸€çš„æ¡ç›®ï¼Œè€Œä¸æ˜¯å¸¦æœ‰å†å²çš„ï¼Œäº¤å‰å‚è€ƒçš„ã€‚

æ‰€ä»¥æ­¤æ—¶é‡‡ç”¨ git log çš„è¯å°†æ— æ³•æŸ¥çœ‹ç‰ˆæœ¬æäº¤å†å²è®°å½•ã€‚

è¦æƒ³æŸ¥çœ‹å†å²è®°å½•ï¼Œåˆ™éœ€è¦ Unshallow æ“ä½œï¼š

```
1
$ git fetch --unshallow
```

å®ƒå°†ä¼šè§¦å‘æ‹‰å›å…¨éƒ¨çš„å†å²è®°å½•ä»¥åŠç›¸å…³å¯¹è±¡ã€‚

æ“ä½œå®Œæˆä¹‹åï¼Œä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„æœ¬åœ°ä»“åº“ï¼Œä¸€åˆ‡éƒ½å’Œæ­£å¸¸çš„ `git clone` è·å¾—çš„ä»“åº“æ˜¯ç­‰ä»·çš„ã€‚

è¿™ä¹Ÿæ„å‘³ç€ï¼Œä½ éœ€è¦ä¿è¯ä½ çš„ç½‘ç»œè´¨é‡äº†ã€‚

##### Lite unshallow[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#lite-unshallow "Permalink")

å¦‚æœæƒ³è¦ç¨å¾®è½»é‡çº§ä¸€ç‚¹çš„ Unshallowï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰åŠæ³•ï¼Œä¸‹é¢çš„æŒ‡ä»¤å¯ä»¥å°è¯•ï¼š

```
1
$ git fetch --unshallow --filter=blob:none
```

å®ƒçš„ä½œç”¨æ˜¯ç•¥è¿‡ blobs å¯¹è±¡çš„ä¸‹æ‹‰ï¼Œé€šå¸¸è¿™ä¼šå¤§å¹…åº¦èŠ‚çœä¸‹è½½é‡ã€‚

ä¸è¯¥å‘½ä»¤çš„æ ¸å¿ƒæ€æƒ³ç›¸åŒçš„æ˜¯åœ¨ `git clone` æ—¶å°±ç•¥è¿‡ blob å¯¹è±¡ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿè¢«æˆä¸º blobless cloneï¼Œä¸‹é¢å°†äºˆä»¥ä»‹ç»ã€‚

### Blobless Clone[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#blobless-clone "Permalink")

æ‰€è°“çš„ Blobless Cloneï¼Œå°±æ˜¯æŒ‡åœ¨æ‰€æœ‰ä¸‹æ‹‰è¡Œä¸ºä¸­éƒ½è·³è¿‡ blobs å¯¹è±¡ã€‚

ç”±äº blobs å¯¹è±¡å®è´¨æ˜¯ä»“åº“ä¸­å·¥ä½œæ–‡ä»¶çš„æ–‡ä»¶å†…å®¹ï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹è¿™æ„å‘³ç€å¤§æƒé‡çš„ä¸‹è½½æ•°æ®é‡å› æ­¤è€Œå¾—åˆ°èŠ‚çœã€‚æ­£å› ä¸ºå¯¹ blobs å¯¹è±¡çš„ç•¥è¿‡ä¸ä¼šå½±å“åˆ° trees å’Œ commits çš„ä¸‹è½½ï¼Œæ‰€ä»¥åœ¨æœ¬åœ°ä»“åº“ä¸­ git log å°†ä¼šæ˜¯å®Œæ•´æœ‰æ•ˆçš„ã€‚

åŒæ ·åœ°åŸå› ï¼Œæ—¢ç„¶æ²¡æœ‰ä¸‹æ‹‰æ–‡ä»¶å†…å®¹ blobsï¼Œæ‰€ä»¥åœ¨æœ¬åœ°ä»“åº“ä¸­å°±ä¸ä¼šå¤åŸå‡ºå·¥ä½œæ–‡ä»¶æ‹·è´ã€‚è¿™ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼šè¿™ç§æƒ…å†µä¸ bare repo æ˜¯ä¸åŒçš„ï¼Œå› ä¸ºè¿™æ ·çš„æœ¬åœ°ä»“åº“ç›¸æ¯”è¾ƒäº bare blob ç¼ºå¤±äº† blobs å®ä½“ã€‚

å½“ä½ åœ¨è¿™æ ·çš„ blobless ä»“åº“ä¸­å¼€å§‹è¿›ä¸€æ­¥æ“ä½œæ—¶ï¼Œæ¶‰åŠåˆ°çš„ blob å¯¹è±¡å°†è¢«è‡ªåŠ¨è§¦å‘å¹¶ä» remotes æ‹‰å–ã€‚

```
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
$ git clone --filter=blob:none https://github.com/llvm/llvm-project llvm-project-blobless
Cloning into 'llvm-project-blobless'...
remote: Enumerating objects: 4361826, done.
remote: Counting objects: 100% (3285/3285), done.
remote: Compressing objects: 100% (1195/1195), done.
remote: Total 4361826 (delta 2853), reused 2095 (delta 2090), pack-reused 4358541 (from 3)
Receiving objects: 100% (4361826/4361826), 602.63 MiB | 13.54 MiB/s, done.
Resolving deltas: 100% (3430550/3430550), done.
Enumerating objects: 1, done.
Counting objects: 100% (1/1), done.
Writing objects: 100% (1/1), done.
Total 1 (delta 0), reused 1 (delta 0), pack-reused 0 (from 0)
remote: Enumerating objects: 152470, done.
remote: Counting objects: 100% (113697/113697), done.
remote: Compressing objects: 100% (99085/99085), done.
remote: Total 152470 (delta 29815), reused 14612 (delta 14612), pack-reused 38773 (from 3)
Receiving objects: 100% (152470/152470), 238.48 MiB | 1.52 MiB/s, done.
Resolving deltas: 100% (36789/36789), done.
Updating files: 100% (157590/157590), done.

$ du -sh llvm-project-blobless llvm-project-blobless/.git
3.1G	llvm-project-blobless
1.0G	llvm-project-blobless/.git

$
```

blobless çš„é€Ÿåº¦è¾ƒæ…¢ï¼Œè¿™æ˜¯å› ä¸º git clone â€“filter=blob:none çš„æ—¶å€™å®é™…ä¸Šåšäº†ä¸¤æ­¥ï¼š git fetch å’Œ git checkoutã€‚åœ¨ fetch çš„æ—¶å€™ blob çš„ç¡®è¢«æ”¾å¼ƒäº†ï¼Œä½†å½“ checkout çš„æ—¶å€™ï¼Œä¸ºäº†å»ºç«‹å·¥ä½œæ‹·è´çš„æ–‡ä»¶ï¼Œç›¸å…³çš„ blob ä¸å¾—ä¸è¢«ä¸‹è½½å›æ¥ã€‚æ‰€ä»¥ git clone â€“filter=blob:none èŠ‚çº¦çš„ä»½é¢åˆè¢«æ¶ˆè´¹äº†ä¸€éƒ¨åˆ†ï¼Œé€ æˆäº†ç°åœ¨çš„åæœã€‚

å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¦‚æœ bare clone çš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±èƒ½å®Œæ•´åœ°èŠ‚çº¦äº†ï¼Ÿ

#### blobless + Bared[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#blobless--bared "Permalink")

çš„ç¡®å¦‚æ­¤ã€‚æ‰€ä»¥ä¸‹é¢åšå‡ºäº†ç¤ºä¾‹ï¼š

```
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
$ git clone --filter=blob:none --no-checkout https://github.com/llvm/llvm-project llvm-project-blobless-bared
Cloning into 'llvm-project-blobless-bared'...
remote: Enumerating objects: 4361890, done.
remote: Counting objects: 100% (3368/3368), done.
remote: Compressing objects: 100% (1220/1220), done.
remote: Total 4361890 (delta 2910), reused 2164 (delta 2139), pack-reused 4358522 (from 3)
Receiving objects: 100% (4361890/4361890), 599.79 MiB | 14.07 MiB/s, done.
Resolving deltas: 100% (3431888/3431888), done.
Enumerating objects: 1, done.
Counting objects: 100% (1/1), done.
Writing objects: 100% (1/1), done.
Total 1 (delta 0), reused 1 (delta 0), pack-reused 0 (from 0)

$ du -sh llvm-project-blobless-bared llvm-project-blobless-bared/.git
742M	llvm-project-blobless-bared
742M	llvm-project-blobless-bared/.git

$
```

æ³¨æ„çœ‹ï¼Œå¦‚æœ checkout å·¥ä½œæ‹·è´çš„è¯ï¼Œ`.git` ä¸­é¢å¤–éœ€è¦ä¸‹è½½çš„ blob å¯¹è±¡å¤§çº¦ä¸º 300MBï¼ˆ1.1GB-742MBï¼‰ã€‚

#### Shllowed + blobless + bared[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#shllowed--blobless--bared "Permalink")

é€šè¿‡é™åˆ¶å†å²è®°å½•ï¼ˆcommits ä¹ƒè‡³äº treesï¼‰çš„ä¸‹æ‹‰å±‚çº§ä¸ºå•å±‚ï¼ˆ`--depth=1`ï¼‰ï¼Œå¯ä»¥å¯ç”¨æµ…æ‹·è´æœºåˆ¶ï¼Œè¿™ä¼šé™åˆ¶ commits å’Œ trees å¯¹è±¡çš„ä¸‹è½½é‡ã€‚

å°†å®ƒå’Œå‰é¢çš„ blobless å åŠ èµ·æ¥å¯ä»¥è¿›ä¸€æ­¥å‰Šå‡ä¸‹è½½é‡ã€‚

```
1
2
3
4
5
6
7
8
9
10
11
12
13
14
$ git clone --depth=1 --filter=blob:none --no-checkout https://github.com/llvm/llvm-project llvm-project-blobless-bared-shallowed
Cloning into 'llvm-project-blobless-bared-shallowed'...
remote: Enumerating objects: 12897, done.
remote: Counting objects: 100% (12897/12897), done.
remote: Compressing objects: 100% (10124/10124), done.
remote: Total 12897 (delta 70), reused 8154 (delta 55), pack-reused 0 (from 0)
Receiving objects: 100% (12897/12897), 5.15 MiB | 1.68 MiB/s, done.
Resolving deltas: 100% (70/70), done.

$ du -sh llvm-project-blobless-bared-shallowed llvm-project-blobless-bared-shallowed/.git
6.6M	llvm-project-blobless-bared-shallowed
6.6M	llvm-project-blobless-bared-shallowed/.git

$
```

æˆæœæ–ç„¶ï¼Œå¯¹å§ï¼Ÿ

æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œè¿™å‡ ä¹å·²ç»å¤Ÿç”¨äº†ã€‚

ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•çš„åå¤„æ˜¯ git log æ²¡æ³•æŸ¥çœ‹ï¼Œä½ åªèƒ½åœ¨ unshallow ä¹‹åæ‰èƒ½æŸ¥çœ‹ log å’Œæäº¤å†å²ã€‚

ä¸ºäº†è®© unshallow ä¹Ÿè½»é‡çº§ï¼Œä¸‹é¢å¯¹å…¶åŠ ä¸Šäº† `--filter=blob:none`ã€‚

> è¿™ç§åšæ³•å¯¹äº Code Reviewers é€šå¸¸æ˜¯å¤Ÿç”¨çš„ï¼Œä»–ä»¬å¤šæ•°æ—¶å€™ä¸å¿…å…³å¿ƒæ–‡ä»¶çš„å®Œæ•´å†…å®¹è€Œåªéœ€è¦æŸ¥çœ‹å˜æ›´çš„ lines å°±è¶³å¤Ÿäº†ï¼Œæ‰€ä»¥ blobs å¯¹ä»–ä»¬æ¥è®²å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æ— éœ€åœ¨æœ¬åœ°å˜ç°çš„ã€‚

```
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
$ cd llvm-project-blobless-bared-shallowed
$ git fetch --unshallow --filter=blob:none
remote: Enumerating objects: 4261444, done.
remote: Counting objects: 100% (4261435/4261435), done.
remote: Compressing objects: 100% (816018/816018), done.
remote: Total 4253079 (delta 3360725), reused 4247089 (delta 3354878), pack-reused 0 (from 0)
Receiving objects: 100% (4253079/4253079), 548.78 MiB | 14.85 MiB/s, done.
Resolving deltas: 100% (3360725/3360725), completed with 3841 local objects.
Enumerating objects: 1, done.
Counting objects: 100% (1/1), done.
Writing objects: 100% (1/1), done.
Total 1 (delta 0), reused 1 (delta 0), pack-reused 0 (from 0)
remote: Enumerating objects: 12, done.
remote: Counting objects: 100% (12/12), done.
remote: Compressing objects: 100% (12/12), done.
remote: Total 12 (delta 0), reused 12 (delta 0), pack-reused 0 (from 0)
Receiving objects: 100% (12/12), 4.21 KiB | 2.11 MiB/s, done.
From https://github.com/llvm/llvm-project
 * [new tag]                   llvmorg-10-init -> llvmorg-10-init
 * [new tag]                   llvmorg-11-init -> llvmorg-11-init
 * [new tag]                   llvmorg-12-init -> llvmorg-12-init
 * [new tag]                   llvmorg-13-init -> llvmorg-13-init
 * [new tag]                   llvmorg-14-init -> llvmorg-14-init
 * [new tag]                   llvmorg-15-init -> llvmorg-15-init
 * [new tag]                   llvmorg-16-init -> llvmorg-16-init
 * [new tag]                   llvmorg-17-init -> llvmorg-17-init
 * [new tag]                   llvmorg-18-init -> llvmorg-18-init
 * [new tag]                   llvmorg-19-init -> llvmorg-19-init
 * [new tag]                   llvmorg-20-init -> llvmorg-20-init
 * [new tag]                   llvmorg-21-init -> llvmorg-21-init

$ git log --oneline
f37c24194e2b (HEAD -> main, origin/main, origin/HEAD) [Clang] Set the final date for workaround for libstdc++'s `format_kind` (#140831)
2d956d2d4ecd [flang] fix ICE with ignore_tkr(tk) character in explicit interface (#140885)
dc29901efb18 [AMDGPU] PromoteAlloca: handle out-of-bounds GEP for shufflevector (#139700)
d36028120a6e [flang] add -floop-interchange and enable it with opt levels (#140182)
2cf6099cd5fa [NFC][Support] Apply clang-format to regcomp.c (#140769)
fb627e39e28a [LLVM][IR] Replace `unsigned >= ConstantDataFirstVal` with static_assert (#140827)
b5e3d8ec084d [LLVM][TableGen] Use StringRef for various members `CGIOperandList::OperandInfo` (#140625)
a7ede51b556f [mlir][XeGPU] Add XeGPU Workgroup to Subgroup Distribution Pass  (#140805)
...

$ cd ..
$ du -sh llvm-project-blobless-bared-shallowed llvm-project-blobless-bared-shallowed/.git
697M	llvm-project-blobless-bared-shallowed
697M	llvm-project-blobless-bared-shallowed/.git

$
```

æ‰€ä»¥ä¸Šé¢ä¹Ÿå±•ç¤ºäº†ç›¸åº”çš„åç»­æ­¥éª¤ã€‚æ­¤æ—¶ â€“depth=1 å¸¦æ¥çš„ä¼˜åŠ¿å°±åŸºæœ¬ä¸Šè¢«æŠµæ¶ˆäº†ã€‚

ä½†æ˜¯ï¼Œç”±äº shallow clone èƒ½å¤ŸåŠ é€Ÿå½¢æˆæœ¬åœ°å‰¯æœ¬ï¼Œæ‰€ä»¥è¿™ç§åˆ†ä¸¤æ­¥èµ°çš„æ–¹æ³•æœ‰æ—¶å€™å¯¹äºæŠ½è±¡çš„ç½‘ç»œæ¡ä»¶ä»ç„¶æ˜¯å…·å¤‡æ„ä¹‰çš„ã€‚

### Treeless Clone[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#treeless-clone "Permalink")

Trees å¯¹è±¡ä»£è¡¨ç€å·¥ä½œæ‹·è´çš„ç›®å½•ç»“æ„å…³ç³»å’Œæ–‡ä»¶åä¿¡æ¯ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥çœå»å¯¹å…¶çš„ä¸‹è½½ï¼Œä»è€Œæ›´è¿›ä¸€æ­¥åœ°é™ä½ä¸‹è½½é‡ã€‚

```
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
$ git clone --filter=tree:0 --no-checkout https://github.com/llvm/llvm-project llvm-project-treeless-bared
Cloning into 'llvm-project-treeless-bared'...
remote: Enumerating objects: 552618, done.
remote: Counting objects: 100% (23/23), done.
remote: Compressing objects: 100% (23/23), done.
remote: Total 552618 (delta 1), reused 10 (delta 0), pack-reused 552595 (from 4)
Receiving objects: 100% (552618/552618), 193.18 MiB | 13.17 MiB/s, done.
Resolving deltas: 100% (8873/8873), done.
Enumerating objects: 1, done.
Counting objects: 100% (1/1), done.
Writing objects: 100% (1/1), done.
Total 1 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)

$ du -sh llvm-project-treeless-bared llvm-project-treeless-bared/.git
225M	llvm-project-treeless-bared
225M	llvm-project-treeless-bared/.git

$ cd llvm-project-treeless-bared && git log --oneline && cd ..
... (ignored)
```

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œblobless å’Œ treeless ä¸¤è€…ä»»é€‰å…¶ä¸€å·²ç»è¶³ä»¥æ”¹å–„ä½ çš„ä¸‹è½½è´¨é‡äº†ã€‚

> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“å‰ git ä¸æ”¯æŒåŒæ—¶åº”ç”¨ blobless å’Œ treeless çš„ filters æ¡ä»¶ã€‚

### By size[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#by-size "Permalink")

`--filter` è¿˜å¯ä»¥æŒ‡å®šå…¶å®ƒæ¡ä»¶ï¼Œä¾‹å¦‚é™åˆ¶ blob ä¸èƒ½è¶…è¿‡ 1MBï¼š`--filter=blob:limit=1m`ã€‚

å®Œæ•´çš„ `--filter` è¯´æ˜ï¼Œå¯ä»¥åœ¨ä¸‹é¢çš„é“¾æ¥ä¸­æ‰¾åˆ°ï¼š

[Git - git-rev-list Documentation](https://git-scm.com/docs/git-rev-list#Documentation/git-rev-list.txt---filterltfilter-specgt)

### By object type[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#by-object-type "Permalink")

[`git sparse-checkout`](https://git-scm.com/docs/git-sparse-checkout) æ˜¯ä¸€ç§è¾ƒä¸ºè½»é‡çº§çš„ checkoutï¼Œå®ƒæ¯” `--no-checkout` æ¸©å’Œä¸€ç‚¹ï¼Œä½†æ²¡æœ‰ normally checkout é‚£ä¹ˆå¤šï¼Œå¸¦ä¸Šå‚æ•° `--sparse` è¿›è¡Œ `git clone` å³å¯ã€‚

ä¸‹é¢çš„ç¤ºä¾‹æ¥è‡ª GitLab å®˜æ–¹æ–‡æ¡£ï¼š

```
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
# Clone the repo excluding all files
$ git clone --filter=blob:none --sparse git@gitlab.com:gitlab-com/www-gitlab-com.git
Cloning into 'www-gitlab-com'...
remote: Enumerating objects: 678296, done.
remote: Counting objects: 100% (678296/678296), done.
remote: Compressing objects: 100% (165915/165915), done.
remote: Total 678296 (delta 472342), reused 673292 (delta 467476), pack-reused 0
Receiving objects: 100% (678296/678296), 81.06 MiB | 5.74 MiB/s, done.
Resolving deltas: 100% (472342/472342), done.
remote: Enumerating objects: 28, done.
remote: Counting objects: 100% (28/28), done.
remote: Compressing objects: 100% (25/25), done.
remote: Total 28 (delta 0), reused 12 (delta 0), pack-reused 0
Receiving objects: 100% (28/28), 140.29 KiB | 341.00 KiB/s, done.
Updating files: 100% (28/28), done.

$ cd www-gitlab-com

$ git sparse-checkout set data --cone
remote: Enumerating objects: 301, done.
remote: Counting objects: 100% (301/301), done.
remote: Compressing objects: 100% (292/292), done.
remote: Total 301 (delta 16), reused 102 (delta 9), pack-reused 0
Receiving objects: 100% (301/301), 1.15 MiB | 608.00 KiB/s, done.
Resolving deltas: 100% (16/16), done.
Updating files: 100% (302/302), done.
```

For more details, see the Git documentation for [`sparse-checkout`](https://git-scm.com/docs/git-sparse-checkout).

From: [Clone a Git repository to your local computer GitLab Docs](https://docs.gitlab.com/topics/git/clone/)

### partial clone (`no-checkout`)[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#partial-clone-no-checkout "Permalink")

å®é™…ä¸Šï¼Œå‰é¢çš„ç¤ºä¾‹ä¸­å·²ç»æå‰åº”ç”¨äº† `--no-checkout`ã€‚

æœ‰çš„æ—¶å€™è¿™ä¸ªå‚æ•°å¯èƒ½æ˜¯ `--bare`ï¼Œä½†æ˜¯æ„ä¹‰ä¸å˜ï¼Œéƒ½æ˜¯èµ·åˆ°ä¸ checkout æœ¬åœ°å·¥ä½œæ–‡ä»¶çš„ç›®çš„ï¼Œä»è€Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ª bared repoã€‚

ç¤ºä¾‹çœç•¥ã€‚

### å¯èƒ½æœ€å¿«çš„ Clone[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#%E5%8F%AF%E8%83%BD%E6%9C%80%E5%BF%AB%E7%9A%84-clone "Permalink")

ç»¼åˆå‰é¢æåˆ°çš„å„ç§æ–¹å¼ï¼Œå¯ä»¥å¾—åˆ°æœ€å¿«çš„ clone æ–¹æ³•åº”è¯¥æ˜¯ï¼šä¸ä¸‹è½½ blob å¯¹è±¡ï¼Œä¸ç­¾å‡ºæœ¬åœ°æ–‡ä»¶ã€‚ç›¸åº”çš„æ“ä½œæ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š

```
1
2
3
4
5
6
#fastest clone possible:
$ git clone --filter=blob:none --no-checkout https://github.com/llvm/llvm-project llvm-blobless-bared
$ du -sh llvm-blobless-bared llvm-blobless-bared/.git
$ cd llvm-blobless-bared
$ git sparse-checkout init --cone
$ git read-tree -mu HEAD
```

å®Œæ•´çš„æ“ä½œè®°å½•å¦‚ä¸‹ï¼š

```
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
$ git clone --filter=blob:none --no-checkout https://github.com/llvm/llvm-project llvm-blobless-bared
Cloning into 'llvm-blobless-bared'...
remote: Enumerating objects: 4362056, done.
remote: Counting objects: 100% (3418/3418), done.
remote: Compressing objects: 100% (1268/1268), done.
remote: Total 4362056 (delta 2964), reused 2156 (delta 2145), pack-reused 4358638 (from 3)
Receiving objects: 100% (4362056/4362056), 599.87 MiB | 16.26 MiB/s, done.
Resolving deltas: 100% (3432005/3432005), done.
Enumerating objects: 1, done.
Counting objects: 100% (1/1), done.
Writing objects: 100% (1/1), done.
Total 1 (delta 0), reused 1 (delta 0), pack-reused 0 (from 0)

$ du -sh llvm-blobless-bared llvm-blobless-bared/.git
742M	llvm-blobless-bared
742M	llvm-blobless-bared/.git

$ cd llvm-blobless-bared

$
```

ç”±äº git è‡ªèº«çš„é™åˆ¶ï¼Œå› æ­¤ä½ æ— æ³•ç»„åˆ blobless å’Œ treeless æ¡ä»¶ï¼Œè€Œä¸Šé¢åˆ—å‡ºçš„æ–¹æ³•æ˜¯å½“å‰è¯„ä¼°ä¸‹ç›¸å¯¹æœ€å¿«çš„ Clone æ–¹æ³•ï¼Œæœ€ç»ˆè·å¾—çš„æœ¬åœ°å‰¯æœ¬è‡³å°‘ä¿è¯äº† commits history èƒ½å¤Ÿè¢«æœ‰æ•ˆåœ°æ£€ç´¢ã€‚

#### æ›¿æ¢ä¸º treeless[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#%E6%9B%BF%E6%8D%A2%E4%B8%BA-treeless "Permalink")

ä½†æ˜¯å¦‚æœè¿œç¨‹ä»“åº“ä¸­çš„æ–‡ä»¶å†…å®¹ä¸å¤§ï¼Œæäº¤å†å²å´è¶…è¿‡ä¸‡æ¡ç”šè‡³æ˜¯æ•°ç™¾ä¸‡æ¡ï¼Œè¿™æ—¶å€™ trees å¯¹è±¡çš„ä¸‹è½½é‡å°±ä¸åº”è¯¥å¿½è§†äº†ï¼Œæ­¤æ—¶åº”è¯¥é‡‡ç”¨ treeless çš„æ–¹å¼ã€‚

#### æ›¿æ¢ä¸º sparse checkout[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#%E6%9B%BF%E6%8D%A2%E4%B8%BA-sparse-checkout "Permalink")

å¦‚æœä½ éœ€è¦æœ¬åœ°çš„å·¥ä½œæ–‡ä»¶å‰¯æœ¬ï¼Œé‚£ä¹ˆæœ€å¿«çš„ clone æ˜¯ shallow+sparse æ–¹æ³•ï¼š

```
1
2
3
4
5
6
7
#fastest clone possible:
$ git clone --filter=blob:none --sparse --depth=1 https://github.com/llvm/llvm-project llvm-sparse
$ du -sh llvm-sparse llvm-sparse/.git
$ cd llvm-sparse
$ git sparse-checkout init --cone
$ git read-tree -mu HEAD
$ git fetch --unshallow
```

å®ƒä¼šå°½å¿«å¾—åˆ°æœ¬åœ°å·¥ä½œæ–‡ä»¶ï¼Œä½†æ— æ³•è¿›è¡Œ git log æ“ä½œï¼Œç›´åˆ°ä½  unshallow å®ƒä¸ºæ­¢ã€‚

èƒŒæ™¯çŸ¥è¯†[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86 "Permalink")
---------------------------------------------------------------------------------------------------------------------

### Blobs, Trees, Commits & Logs[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#blobs-trees-commits--logs "Permalink")

Git çš„å®ç°æœºç†ä¸­ï¼Œå››ç§åŸºç¡€å¯¹è±¡æŒ‰ç…§å®ƒä»¬æ‰¿è½½çš„æ„ä¹‰ç›¸äº’ç»„ç»‡åœ¨ä¸€èµ·ï¼Œæ„æˆäº†æˆ‘ä»¬æ‰€è·å¾—çš„ç‰ˆæœ¬å†å²çš„æ‹¼å›¾ï¼›åŒæ—¶ï¼Œè¿™äº›åŸºç¡€å¯¹è±¡æŒ‰ç…§é€‚å½“çš„å…³ç³»ç›¸äº’å‹¾ç¨½ï¼Œä¹Ÿå½¢æˆäº†æˆ‘ä»¬æ‰€æåŠè¿‡çš„ç£ç›˜å­˜å‚¨ä¸­çš„æ•°æ®åº“ç»“æ„ã€‚

ç†è§£ä¸Šè¿°çš„å››ç§å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥é˜…è¯» ProGit Book çš„ [Git - Git å¯¹è±¡](https://git-scm.com/book/zh/v2/Git-%e5%86%85%e9%83%a8%e5%8e%9f%e7%90%86-Git-%e5%af%b9%e8%b1%a1) ç« èŠ‚ã€‚

å…¶ä¸­çš„å…³ç³»å›¾æ¯”è¾ƒæœ‰å‚è€ƒä»·å€¼ï¼š

[![Image 1: ä½ çš„ Git ç›®å½•ä¸‹æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ã€‚](https://cdn.jsdelivr.net/gh/hzimg/blog-pics@master/upgit/2025/05/20250524_1748041047.png)](https://cdn.jsdelivr.net/gh/hzimg/blog-pics@master/upgit/2025/05/20250524_1748041047.png "Click on image to enlarge it at full screen")

å®ƒå±•ç¤ºäº† commits, trees, filenames, blobs(file contents) ä¹‹é—´çš„é€»è¾‘ç»„ç»‡å…³ç³»ã€‚

**`Blobs`** ä»£è¡¨ç€æ¯ä¸ªå·¥ä½œæ–‡ä»¶çš„å†…å®¹ã€‚

**`Trees`** ä»£è¡¨ç€æ–‡ä»¶å¤¹åç§°å’Œæ–‡ä»¶åç§°ï¼ŒåŒæ—¶ä¹Ÿæ¶µç›–äº†æ–‡ä»¶å¤¹å±‚çº§ç»“æ„ã€‚

**`Commits`** å¯¹åº”ç€ç‰ˆæœ¬å†å²ä¸­çš„æ¯ä¸€æ¡æäº¤è®°å½•ï¼Œæ¯ä¸ªæäº¤ç”±ä¸€ä¸ªå”¯ä¸€çš„ hash ä¸²æ ‡è¯†ï¼ˆæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé’ˆå¯¹è¯¥æäº¤è®°å½•çš„ sha-1 æ‘˜è¦ï¼‰ï¼Œhash ä¸²è¢« base64 æ ¼å¼åŒ–åçš„é•¿åº¦ 40 charsï¼Œé€šå¸¸å–å…¶å‰ 6 æˆ– 8 ä½ä½œä¸ºçŸ­è¯­ï¼Œä»æ¦‚ç‡ä¸Šè¯´å¯¹äºå•ä¸€çš„ä»“åº“è€Œè¨€å‰ 8 ä½è¶³ä»¥å”¯ä¸€åœ°è¯†åˆ« Commits äº†ï¼Œå¦‚ `70460b`ã€‚

**`Logs`** æ˜¯å…³è”åˆ°æ¯ä¸€ Commit çš„æ—¥å¿—ä¿¡æ¯ï¼Œç”± `git log` äºˆä»¥å‘ˆç°ã€‚

**`Refs`** æ˜¯åœ¨ Commits å†å²ä¸Šçš„ç‰¹å®šä½ç½®çš„ç²˜è¿çš„æ ‡è®°ã€‚é€šç”¨åœ°çœ‹ï¼Œæ¯ä¸ª hash ä¸²éƒ½æ˜¯ä¸€ä¸ª refï¼Œæ­¤å¤–è¯¸å¦‚ branchï¼Œtags ç­‰ä¹Ÿéƒ½æ˜¯æŸä¸ªæäº¤çš„åˆ«åï¼Œä¹Ÿè¢«è§†ä¸º ref çš„ä¸€ç§ï¼Œå¹¶ä¸”æœ‰å¯¹åº”çš„é€»è¾‘åå­—ï¼Œä¾‹å¦‚ `refs/heads/master`ï¼Œ`refs/tags/v1.0.0`ï¼Œ`refs/remotes/origin/master` ç­‰ç­‰ã€‚è¿™æ–¹é¢ä¿¡æ¯è¯·é˜…è¯» Git Pro çš„ [Git - Git å¼•ç”¨](https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-Git-%E5%BC%95%E7%94%A8) ç« èŠ‚ã€‚

### ç»“æŸè¯­[Permalink](https://hedzr.com/devops/git/lite-clone-a-git-repo/#%E7%BB%93%E6%9D%9F%E8%AF%AD "Permalink")

è¿˜æœ‰æ²¡æœ‰æ›´å¿«çš„æ–¹æ³•ï¼Ÿ

çš„ç¡®è¿˜æœ‰ä¸€ç§ï¼š

ä½¿ç”¨ä½ çš„ github èº«ä»½ç”³è¯·å…è´¹çš„ Azure Linux ä¸»æœºï¼Œç„¶å SSH è¿›å»åš git cloneï¼Œç§’é€Ÿï¼

è¿™æ ·ä¸ä½†èƒ½å¤Ÿå¾—åˆ°å®Œæ•´ä»“åº“ï¼Œé€Ÿåº¦ä¸Šçš„æŸå¤±ä¹Ÿæ²¡æœ‰å¤šå°‘ã€‚

ä½†è¿™ç§æ–¹æ³•ä¹Ÿæœ‰é™åˆ¶ï¼Œå› ä¸ºå…è´¹ä¸»æœºçš„ç£ç›˜ç©ºé—´æœ‰é™ï¼Œæ‰€ä»¥å¤ªå¤§çš„ repo å¯èƒ½ä½ è¿˜æ˜¯æ— æ³•ä¸‹æ‹‰ã€‚

å¦‚æœ clone æˆåŠŸäº†ï¼Œä½ å¯ä»¥ zip é‚£ä¸ªç›®å½•ï¼Œç„¶åç”¨ sftp æ–­ç‚¹ç»­ä¼ åœ°ä¸‹æ‹‰åˆ°æœ¬åœ°åœ¨è§£å‹ç¼©å›æ¥ï¼Œè¿™å¯èƒ½æ˜¯æœ€é€‚åˆç½‘ç»œæ¡ä»¶ä¸ç¨³çš„åœºæ‰€çš„æ–¹æ¡ˆã€‚

ğŸ”š
