# DumPy: NumPy except it’s OK if you’re dum
- URL: https://dynomight.net/dumpy/
- Added At: 2025-05-23 14:52:49

## TL;DR


DumPy通过命名轴和显式索引语法简化高维数组操作，利用JAX的vmap自动向量化处理，确保GPU高性能。其禁止隐式广播与花式索引，要求维度显式匹配，避免歧义。实验显示其代码直观性接近手动循环（9.5/10），远超NumPy（4.3/10），但牺牲了部分广播灵活性，强调用户主动指导而非被动适配的编程哲学。

## Summary


DumPy旨在通过重新引入显式索引和循环的语法并借助JAX的向量化技术，简化高维数组操作，减少用户在维度匹配和数组广播上的认知负担。其核心设计原则包括：

1. **减少不必要的思考**：避免NumPy复杂的广播、花式索引和函数矢量化规则带来的不确定性，用户可通过直观的索引符号直接表达计算逻辑。

2. **高性能GPU执行**：利用循环和索引语法替代隐式广播，使所有操作隐式编译为向量化GPU指令，无需手动调整维度。

3. **简化维度管理**：
   - 引入命名轴（如`i`, `j`）替代位置轴，要求所有索引显式匹配维度标签。
   - 禁止多个数组索引直接广播（如`A[B,C]`），强制通过命名轴对齐维度。
   - 禁用NumPy的形状广播规则，仅允许相同形状或标量间的运算。
   - 移除函数的复杂矢量化逻辑，要求输入维度小于等于2（如`dp.linalg.solve`）。

**实现方式**：
- 循环和索引语法被解析为映射维度（如`A['i','j',:,:]`）。
- JAX的`vmap`自动处理命名轴的向量化，无需手动嵌套vmapping（如通过`Z[i,j] = ...`编译为向量化操作）。
- `dp.Slot`用于声明输出维度，并通过显式索引"绑定"计算结果到特定轴。

**对比示例**：
- 匿名索引需手动指定轴标签，但代码可读性强（如高维数组运算、注意力机制实现）。
- 相比NumPy的`einsum`和PyTorch的`vmap`，DumPy的语法更接近数学表达式，且无需显式设计batch维度逻辑。
- 禁用花式索引的复杂行为，强制单一数组索引且显式声明所有维度，减少歧义。

**被移除的特性**：
- 广播机制：仅支持相同形状或标量运算。
- 多数组复杂索引：禁止多个非标量数组索引同时作用。
- 复杂函数矢量化：如`dp.linalg.solve`仅处理2D输入，依赖用户显式映射维度。

**与其他工具的比较**：
- APL类语言依赖位置轴对齐，可能引发维度混乱。
- xarray使用永久命名维度，但在线性代数运算中导致维度名称冲突或冗余。
- Julia的快速循环无法直接解决GPU并行问题，但其元编程特性可能更适配DumPy的设计。

**原型实现**：
- DumPy的原型基于JAX实现，仅需700行代码，通过`jax.vmap`和`jax.jit`支持GPU和自动求导。
- 作者通过6个案例的主观评分实验，显示DumPy在直观性上接近原始循环代码（9.5/10），显著优于NumPy（4.3/10）。但JAX的vmap在注意力机制问题上仍需较多嵌套。

DumPy的核心优势在于：通过命名轴和显式索引简化高维问题，消除维度推理的隐式规则，同时保持高性能的底层计算，但需牺牲部分NumPy的灵活广播特性。其设计哲学强调"用户指导计算"而非"计算适应用户"，避免依赖晦涩的数组操作技巧。
