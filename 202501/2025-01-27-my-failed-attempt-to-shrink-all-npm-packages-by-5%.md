# My failed attempt to shrink all npm packages by 5%
- URL: https://evanhahn.com/my-failed-attempt-to-shrink-all-npm-packages-by-5-percent/
- Added At: 2025-01-27 12:51:42
- [Link To Text](2025-01-27-my-failed-attempt-to-shrink-all-npm-packages-by-5%_raw.md)

## TL;DR
作者提出使用Zopfli压缩工具减少npm包大小的提案，实验证明可行且能减少约6.2%的大小。尽管提案被npm维护者拒绝，作者从中学会了如何提交RFC，并认识到实施改进需权衡利弊。尽管提案未通过，作者仍在自己项目中继续使用Zopfli进行优化。

## Summary
1. **项目背景**：
   - **目标**：作者希望通过使用Zopfli压缩工具，将所有新发布的npm包的大小减少约5%，从而提升性能并降低存储成本。
   - **结果**：尽管作者认为这是一个明显的改进，但提案最终被npm维护者拒绝。

2. **技术背景**：
   - **npm包的分布**：npm包是以gzip压缩的tar档案形式发布的，即`.tar.gz`或`.tgz`文件。
   - **Zopfli压缩工具**：Zopfli能生成比常规gzip更小的文件，但压缩速度较慢，适合不常变化的内容。

3. **概念验证**：
   - **实验过程**：作者使用自己的npm包进行实验，通过Zopfli重新压缩包，成功减少了约6.2%的大小，且完全向后兼容。
   - **结果**：实验表明，使用Zopfli压缩npm包是可行的，且对用户无感知影响。

4. **反馈与提案**：
   - **初步反馈**：作者向同事征求反馈，发现解压时间和npm的`package-lock.json`中的校验和可能是问题。
   - **正式提案**：作者向npm提交了RFC，详细说明了使用Zopfli压缩npm包的潜在好处和挑战。

5. **讨论与决策**：
   - **讨论会议**：npm维护者讨论了作者的提案，虽然认为压缩改进是受欢迎的，但也提出了实施上的挑战和潜在问题。
   - **最终决定**：经过深入研究和讨论，作者认为实施Zopfli压缩的代价大于收益，最终放弃了提案。

6. **经验教训**：
   - **提案技巧**：作者学会了如何制作和提交正式的RFC，尽管在口头表达上有所不足。
   - **决策过程**：作者认识到，看似明显的改进并不总是易于实施，需要仔细权衡利弊。
   - **个人成长**：尽管提案未获通过，作者认为这次经历使他成为了更好的工程师。

7. **持续实践**：
   - **个人实践**：尽管提案被拒，作者仍然在自己的模块中使用Zopfli进行压缩，持续优化自己的项目。
