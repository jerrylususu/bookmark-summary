# Mocking is an Anti-Pattern
- URL: https://www.amazingcto.com/mocking-is-an-antipattern-how-to-test-without-mocking/
- Added At: 2024-07-20 14:02:56

## TL;DR
文章强调了测试的重要性，指出使用mock测试可能忽略边缘情况和失败模式。建议通过增加单元测试、简化IO测试、分离逻辑与IO、进行E2E集成测试等替代方案来提高测试覆盖率和准确性，避免mock带来的问题。

## Summary
1. **测试的重要性**：作者提倡增加测试覆盖率，并指出在测试包含IO操作的代码时，人们倾向于使用mock。

2. **Mock的定义与问题**：
   - **定义**：Mock是模仿其他服务的对象，如数据库Repository或服务。
   - **问题**：Mock可能导致只测试“快乐路径”，忽略边缘情况和失败模式，从而产生错误的信心。

3. **Mock的替代方案**：
   - **更多单元测试**：通过重构代码，如分解条件和引入参数对象，使代码更易测试。
   - **简化IO测试**：使用内存数据库或虚拟文件系统来替代实际IO操作，提高测试速度。
   - **直接进行IO操作**：随着IO速度的提升，直接进行IO操作可能成为可行方案。
   - **逻辑与IO分离**：通过命令模式或函数式编程中的Monad等方法，将业务逻辑与IO操作分离。
   - **E2E集成测试**：进行端到端测试，直接测试真实的服务交互，避免mock带来的问题。

4. **Mock的具体问题**：
   - **边缘情况**：Mock可能未涵盖服务的所有边缘情况，导致潜在的bug未被发现。
   - **失败模式**：Mock可能未正确模拟服务的所有失败模式，导致测试不全面。

5. **实际案例分析**：
   - **示例代码**：通过示例代码展示了如何使用mock进行测试，并指出这种测试可能不涵盖所有实际场景。
   - **替代方案的应用**：通过具体案例展示了如何通过重构代码和使用内存数据库等方法来替代mock。

6. **总结**：Mocking被视为一种反模式，因为它增加了复杂性，难以维护，且可能产生错误的信心。建议优先考虑其他测试方法，如单元测试、E2E测试等。
