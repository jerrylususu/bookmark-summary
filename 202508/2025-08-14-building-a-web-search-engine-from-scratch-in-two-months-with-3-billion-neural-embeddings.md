# Building a web search engine from scratch in two months with 3 billion neural embeddings
- URL: https://blog.wilsonl.in/search-engine/
- Added At: 2025-08-14 14:19:47
- [Link To Text](2025-08-14-building-a-web-search-engine-from-scratch-in-two-months-with-3-billion-neural-embeddings_raw.md)

## TL;DR


作者在两个月内基于30亿SBERT神经嵌入开发搜索引擎，通过200块GPU构建索引，实现每秒50K网页爬取及500ms查询延迟。采用分布式爬虫、HNSW算法与语义理解技术，有效过滤SEO垃圾内容并提升长尾查询相关性。系统采用开源组件及Oracle云优化成本，已部署公开演示版本支持精准语义搜索。

## Summary


作者在两个月内从零搭建了一个基于30亿神经嵌入的网页搜索引擎，核心目标是提升搜索质量并降低SEO垃圾内容影响。技术亮点包括：

**技术指标**  
- 使用200块GPU生成30亿SBERT神经嵌入  
- 50K网页/秒的爬取速度，最终索引2.8亿网页  
- 查询延迟优化至500ms  
- 硬件架构：200核CPU+4TB内存+82TB SSD存储  
- 存储层使用RocksDB与HNSW图算法分片存储索引  

**关键技术环节**  
1. **数据采集**  
- 分布式爬虫集群实现流量均摊，应对IP限速  
- 自定义DNS解析避免私有地址泄露  
- URL规范化处理包括协议过滤、路径转义、参数排序  

2. **内容处理**  
- HTML净化：保留语义标签（p/table/pre/blockquote等），删除导航栏、侧边栏、广告等非核心内容  
- 维基百科等特殊网站采用硬编码过滤规则剔除参考文献、评论区等噪声  
- 结构化数据提取：解析OpenGraph/Microdata等元数据构建知识图谱  

3. **语义分割**  
- 基于spaCy模型进行句子分割，保留章节标题/表格头等上下文信息  
- 语句链模型（DistilBERT训练）识别依赖句式，确保指代解析的连贯性  
- 典型处理：将表格单元格数据结合表头/段落标题生成关联上下文  

4. **索引构建**  
- SBERT模型将文本映射为向量，通过HNSW算法构建高效搜索索引  
- 索引分片部署在200个CPU核心上，支持并行搜索  

5. **系统架构**  
- 内存队列系统协调分布式任务，实现毫秒级状态更新（Push/O(1), Poll/O(k), 完成/O(1)）  
- 开源RocksDB队列库替代SQS，实现单节点30万TPS  
- 服务网格设计支持爬虫、处理、存储各环节的并行化  

**创新点**  
- 语义理解能力：能解析"意同意图"查询，如通过"为何CORS配置无效"自然关联到一致性模型说明  
- 长尾内容挖掘：通过嵌入相似度计算，可从技术文档中提取非显式提及的技术细节（如隐式说明Lua支持）  
- 上下文关联：表格单元格与标题/前文的语义整合提升搜索相关性  

**成本控制**  
- 选择Oracle云降低存储与出口流量成本，10TB/月免费数据迁移额度  
- 开源组件替代商业服务（如用RocksDB自建队列系统降低队列成本）  

项目部署了一个公开演示版，支持复杂语义查询并展示段落级精准结果。下一步计划包括强化知识图谱、引入增量索引更新及多语言支持。
