# Your MCP Doesn’t Need 30 Tools: It Needs Code
- URL: https://lucumr.pocoo.org/2025/8/18/code-mcps/
- Added At: 2025-08-18 13:54:58
- [Link To Text](2025-08-18-your-mcp-doesn’t-need-30-tools-it-needs-code_raw.md)

## TL;DR


文章提出通过模型上下文协议（MCP）结合代码接口（如Python/JavaScript）优化任务执行。指出CLI工具存在兼容性差、状态管理脆弱及安全验证延迟等问题，而MCP借助代码直接操作底层工具（如pexpect控制LLDB、Playwright自动化网页），可保留执行状态、简化工具链并提升交互灵活性，同时生成可复用脚本。尽管直接执行代码存在安全风险，但实验证明其在调试和Web自动化场景中效果显著，未来需进一步探索防护技术。

## Summary


文章探讨了模型上下文协议（MCP）在任务执行中的优化路径，指出应减少对多工具依赖，转而通过代码（如Python/JavaScript）与MCP结合实现高效交互。核心观点如下：

### 一、CLI工具的局限性
1. **兼容性与可靠性问题**：CLI工具存在平台依赖、版本差异和文档缺失问题，导致首次使用易出错。处理非ASCII字符（如换行符）时，工具参数传递常失效。
2. **复杂场景的脆弱性**：涉及多步骤操作（如tmux控制远程LLDB会话）时，代理难以维护会话状态，易因小错误重启流程，导致效率低下。
3. **安全预检开销**：部分代理（如Claude）在执行shell命令前需通过安全模型验证，增加延迟。

### 二、MCP与代码接口的优势
1. **单工具MCP架构**：通过MCP暴露单一工具（如基于pexpect的Python解释器），允许代理发送代码直接操作底层工具。代码可保留执行状态，避免工具链耦合问题。
   - **pexpect案例**：Python库pexpect用于自动化CLI交互，MCP工具通过`eval()`执行Python代码（如启动/调试LLDB），实现状态管理和复杂流程控制。示例中，代理通过发送Python代码逐步调试崩溃的C程序，并自动生成可复用的调试脚本。
   - **Playwright实验**：用JavaScript直接操作Playwright API的MCP，将30+工具定义简化为1个接口，提升网页交互灵活性（如抓取链接时自动捕获日志，无需显式请求数据）。

2. **代码执行的拓展性**：
   - **状态管理**：通过保留Python/JavaScript的运行时状态，代理可积累中间数据（如页面翻页时存储信息），减少重复推理。
   - **可复用性**：代码输出模式使其天然支持生成独立脚本（如调试后的Python脚本），脱离MCP实现快速复用。

### 三、安全与风险考量
- **安全防护的局限性**：直接执行代码（如eval）看似风险高，但与代理生成可执行代码并运行的现有模式本质相似，当前技术更侧重能力探索而非绝对安全。
- **缓解策略**：沙箱隔离系统调用或引入策略框架是潜在方向，但面对AI的潜在绕过能力，完全防护仍具挑战。

### 四、结论
通过代码接口整合工具，MCP能更高效管理状态、降低工具链复杂度，同时保持灵活性与可维护性。尽管安全问题待解，但实践显示此方法在调试、Web自动化等场景已显显著优势。
