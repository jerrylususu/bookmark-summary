# HTTP is not simple
- URL: https://daniel.haxx.se/blog/2025/08/08/http-is-not-simple/
- Added At: 2025-08-09 06:42:10

## TL;DR


本文反驳了HTTP是简单协议的观点，指出其复杂性源于HTTP/1的底层设计缺陷（如消息体处理、头部字段规则）、长期扩展导致的规范膨胀（需依赖40+ RFC文档）、遗留特性累积（如极少使用的100响应码）、浏览器兼容性压力，以及HTTP/2/3对旧版的兼容要求。尽管复杂性持续增长，HTTP仍因实用性长期主导网络通信。

## Summary


本文反驳了“HTTP是简单协议”的观点，通过多年实践与标准化参与经验，说明HTTP的复杂性。关键点如下：  

### **HTTP复杂性的核心原因**  
1. **HTTP/1的隐藏复杂性**  
   - **文本协议的局限性**：虽为文本协议，但需处理任意长度行、CRLF结束符差异、非UTF-8字符等，易引发安全问题。  
   - **消息体结束方式多样**：需处理`Content-Length`、分块编码、`Connection: close`三种机制，导致安全漏洞频发。  
   - **头字段处理复杂**：折叠头（折叠或合并）、令牌格式（自由文本或引号包裹）、特殊头（如Cookie不可合并）等需严格处理。  

2. **规范与实现的鸿沟**  
   - **未实现的特性**：如HTTP/1.1的管道化（Pipelining）因兼容性问题难以落地，需依赖后续版本的多路复用方案。  
   - **遗留特性的影响**：如`100 Continue`响应码极少使用，却增加实现复杂度，相关讨论持续近30年仍未完全解决。  

3. **扩展性与规格膨胀**  
   - **头字段的泛滥**：HTTP/1.1规范本身未涵盖Cookie、身份验证等关键功能，需依赖额外40+ RFC文档，部分协议细节甚至未进入RFC（如NTLM）。  
   - **方法与头的行为差异**：不同HTTP方法（如GET、POST）对请求体的支持混乱，推动新方法（如QUERY）开发却未简化协议。  

4. **浏览器兼容性压力**  
   - **灵活兼容性需求**：浏览器倾向模糊错误以改善用户体验，导致非浏览器端需遵循浏览器行为而非严格规范，加剧实现难度。  

### **协议的演变与规模**  
- **规范文档的爆炸**：HTTP/1.1从最初RFC 2068的5万余字，扩展至拆分6个文档后的9万余字（约平均小说长度），甚至需7小时以上阅读。  
- **后续版本的复杂积累**：HTTP/2和HTTP/3需兼容HTTP/1，进一步叠加协议复杂性。  

### **与其他协议的对比**  
- **类似问题的普遍性**：如DNS、SMTP等协议亦始于简单设计，随时间推移功能膨胀，复杂度激增。  

### **结论**  
HTTP远非简单协议，其复杂性源于长期扩展、遗留问题、兼容性需求及规范碎片化。未来随着新功能的添加，复杂度将持续上升，但协议的普及与成功难以与之割裂。
