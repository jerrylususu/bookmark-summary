# too many model context protocol servers and LLM allocations on the dance floor
- URL: https://ghuntley.com/allocations/
- Added At: 2025-08-23 04:23:44

## TL;DR


本文指出过度使用模型上下文协议（MCP）服务器和LLM分配会造成开发效率下降、输出质量恶化及安全风险。工具安装过多会消耗大量token空间，引发冲突和非确定性行为，甚至引入恶意指令攻击。建议采用“少即多”原则，按需启用工具，分层级管理MCP，动态控制资源，并推动标准化协议以优化安全性和性能。（99字）

## Summary


本文探讨了过度使用模型上下文协议（MCP）服务器和LLM分配对开发效率及安全性的负面影响，并提出了优化建议：

---

### **核心论点**
1. **“少即多”原则**：在LLM上下文窗口中过度分配工具或MCP服务器会恶化输出质量，增加意外行为风险。
2. **企业与开发者需警惕AI泡沫**：当前MCP生态存在盲目安装工具现象，导致资源浪费和性能问题。

---

### **关键概念解释**
1. **工具**：  
   - MCP工具通过广告牌描述提供功能（如文件列表工具）。  
   - 每个工具占用上下文窗口的token，冲突可能导致非确定性行为。  
   - 示例代码：`list_files`工具描述占用约93 token。

2. **Token与上下文窗口**：  
   - LLM通过token处理文本，上下文窗口为可处理的最大token数。  
   - 广告的窗口大小（如200k token）需减去系统提示词（12k）和外壳占用（12k），实际可用仅为176k。

---

### **问题与风险**
1. **过度分配的后果**：  
   - 安装Reddit推荐的8个MCP服务器后，可用token从178,000骤降至84,717。  
   - 极端案例中，经扩展配置后可用token可能仅剩20k，导致输出质量显著下降。  
   - **阈值建议**：仅使用100k token以内。

2. **工具冲突与非确定性**：  
   - 不同MCP工具可能提供相同功能（如文件列表），LLM可能混淆选择，加剧不确定性。  
   - 工具描述缺乏命名空间，语言模型（如GPT-5对大写字母敏感）的适配问题未被广泛讨论。

3. **安全风险**：  
   - 未命名的上下文窗口内容可能包含恶意指令（如亚马逊Q事件中的供应链攻击）。  
   - 工具描述、系统提示与外壳指令统一视为潜在执行对象，需严格控制。

---

### **解决方案**
1. **最小化MCP安装**：  
   - **不安装GitHub MCP**：GitHub CLI已集成模型权重，无需额外MCP服务器。  
   - 企业应禁止第三方MCP，推荐自建第一方解决方案（如Ansible部署）。

2. **区分工具层级**：  
   - **S级公司**（如GitHub）：工具自带CLI且预置模型权重，无需MCP。  
   - 非S级公司：若工具无CLI或未被模型支持，需通过MCP扩展功能。

3. **动态管理策略**：  
   - 开发阶段按需启用/禁用MCP（如计划阶段开启Jira MCP，完成后关闭）。  
   - 参考“最小权限”原则减少攻击面。

4. **优化建议**：  
   - 参考Ralph技术（类似Kubernetes调度）自动垃圾回收上下文内容。  
   - 定期清除超过100k token的上下文，避免“上下文退化”问题。

---

### **未来展望**
- 推动标准化协议，允许外壳动态控制MCP工具分配，结合开发阶段需求（如SDLC）优化安全与效率。  
- 关注“致命三要素”（隐私数据、外部通信、未验证内容）的防护机制。
