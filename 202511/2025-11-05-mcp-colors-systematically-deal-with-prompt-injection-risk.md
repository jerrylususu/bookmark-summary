# MCP Colors: Systematically deal with prompt injection risk
- URL: https://timkellogg.me/blog/2025/11/03/colors
- Added At: 2025-11-05 13:34:59
- Tags: #read #llm #security
- [Link To Text](2025-11-05-mcp-colors-systematically-deal-with-prompt-injection-risk_raw.md)

## TL;DR
文章提出MCP Colors方法应对提示注入风险：通过红（不可信内容）蓝（关键操作）颜色标记隔离风险操作，简化安全评估。需人工参与威胁建模，强调安全无法完全自动化，但为通用代理提供可行路径。

## Summary
这篇文章提出了一种名为“MCP Colors”的方法，用于系统性地处理提示注入风险。核心内容可总结如下：

**问题背景**
- 提示注入是AI应用中的严重安全风险，但许多应用目前选择忽视，等待解决方案出现。
- 作者强调，可靠检测提示注入攻击是不可能的，需要接受这一前提。

**安全框架演变**
- 基于Simon Willison提出的“致命三要素”理论（包含外部通信、状态改变等），作者将其简化为两个核心类别，用颜色标记：
  - **红色（不可信内容）**：如来自外部网络的数据输入。
  - **蓝色（关键操作）**：如发送邮件或权限更改等有风险的操作。
- 作者将“关键操作”扩展为更广义的概念，涵盖可能引发严重后果的行为，即使不涉及状态改变。

**方法实施**
- **颜色标记规则**：代理（agent）不能同时使用红色和蓝色工具或数据，必须隔离。
- **标记过程**：通过手动或自动化方式（如使用LLM和电子表格）为所有MCP工具和数据输入标记颜色，利用`_meta`对象跟踪。
- **去色（De-coloring）**：探讨通过验证（如人工审核或LLM判断）降低数据风险，使红色工具可安全使用。
- **颜色等级**：建议引入1-5级的信任度，允许部分信任，以适配不同风险偏好和精细控制。

**优势与挑战**
- **优势**：
  - 简化安全评估，只需关注单个工具的风险。
  - 帮助明确代理的使用场景，避免工具组合爆炸（O(n^m)）带来的安全测试复杂性。
  - 为通用代理的安全运行提供路径，支持工具动态发现。
- **挑战**：
  - 需要提前思考威胁模型和工具用途，无法完全自动化安全。
  - 没有“免费午餐”，安全依赖于主动管理和风险评估。

**结论**
- 该方法旨在缩小讨论范围，使安全问题更易处理，但强调安全需要投入思考和规划。作者欢迎反馈，认为这是向安全通用代理迈出的可行一步。
