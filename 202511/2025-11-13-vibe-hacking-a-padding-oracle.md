# Vibe hacking a padding oracle
- URL: https://beny23.github.io/posts/capturing_a_padding_oracle/
- Added At: 2025-11-13 14:01:12
- Tags: #read #security
- [Link To Text](2025-11-13-vibe-hacking-a-padding-oracle_raw.md)

## TL;DR
这篇文章记录作者在CTF挑战中利用编码绕过、填充预言机和SQL注入等漏洞攻破一个加密粘贴板服务，成功获取四个Flag的过程。挑战暴露了错误信息泄露、加密实现缺陷及数据库安全问题，凸显了漏洞链的危害。

## Summary
这篇文章详细记录了作者在Hacker101 CTF中完成“Encrypted Pastebin”（困难模式）挑战的过程。挑战目标是发现并利用一个Web应用中的安全漏洞，获取隐藏的四个Flag。该应用是一个加密粘贴板服务，用户输入的内容会通过AES-CBC加密后存储在URL参数中。

### 漏洞发现与利用步骤

1. **Flag 1**  
   - 通过向URL参数`post`提交无效值（如`1`），触发了错误消息，直接暴露了第一个Flag。
   - 错误堆栈还泄露了关键信息：数据使用自定义Base64编码（字符`~!-`对应标准`=/+`），且负载为JSON格式。

2. **Flag 2**  
   - 通过分析错误堆栈，发现应用存在填充预言机（Padding Oracle）漏洞。错误消息的不同（如填充错误、IV长度错误等）可被用于推断加密细节。
   - 借助ChatGPT的建议，作者编写了一个Python脚本（利用多线程）实施填充预言机攻击，成功解密了一个示例负载，获取了第二个Flag。解密后的JSON包含一个随机生成的加密密钥，验证了服务声称的“密钥不存储”机制。

3. **Flag 3**  
   - 利用填充预言机的加密功能，作者构造了一个包含SQL注入的负载（如`{"id": "1"}`），加密后提交到服务。
   - 服务在解析时泄露了标题字段，其中包含第三个Flag。这可能是开发时遗留的调试信息。

4. **Flag 4**  
   - 进一步利用SQL注入，通过联合查询（UNION）从数据库的`information_schema`中提取表结构，发现存在`tracking`表。
   - 查询`tracking`表获知，该表记录了访问`tracking.gif`的请求头信息，其中包含一个本地请求（127.0.0.1）的加密负载。
   - 直接提交该负载到服务，成功解密后获取了第四个Flag，实现了无需密钥的数据窃取。

### 漏洞总结
挑战暴露了多项安全缺陷：
- **信息泄露**：错误堆栈和 verbose 错误消息泄露了系统内部细节。
- **填充预言机**：CBC模式加密结合错误反馈，允许攻击者解密或加密任意数据。
- **SQL注入**：未过滤的用户输入导致数据库信息被窃取。
- **加密弱点**：使用静态密钥、CBC模式（已过时），且密钥在URL中传输。
- **数据暴露**：`tracking`表存储敏感头信息，缺乏访问控制。

### 技术收获
作者通过“氛围编程”（vibe coding）和LLM辅助，快速开发了攻击工具，体现了自动化在渗透测试中的实用性。同时，挑战加深了对填充预言机攻击原理和实践的理解，强调了安全开发中避免信息泄露和正确实施加密的重要性。

整个过程融合了应用安全、密码学和数据库攻击，展示了现实世界中漏洞链的危害性。
