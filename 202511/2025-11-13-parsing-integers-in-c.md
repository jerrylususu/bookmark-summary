# Parsing integers in C
- URL: https://daniel.haxx.se/blog/2025/11/13/parsing-integers-in-c/
- Added At: 2025-11-13 13:37:38
- Tags: #read #c

## TL;DR
C语言标准库的整数解析函数如atoi和strtol存在错误处理不严、易溢出等问题。curl项目为增强安全性实现了自定义解析函数，严格处理溢出和输入格式，并已全面替换标准库函数。

## Summary
这篇文章讨论了C语言中解析整数的几种方法，并重点介绍了curl项目如何通过自定义函数实现更严格的解析。

- **标准库函数的不足**：常用的`atoi`和`strtol`等函数存在缺陷，如缺乏错误检查、溢出处理不完善、平台依赖性导致类型大小不一致，且过于宽松地接受输入（如允许前导空格和正负号），容易引发安全问题。
- **curl项目的严格解析原则**：curl项目强调在解析协议和数据时应保持严格，拒绝语法错误，确保安全性和功能可靠性。所有数字解析必须精确处理溢出、最大允许值，并支持64位数字。
- **自定义解析函数**：curl项目实现了自己的解析函数`curlx_str_number`，它直接解析字符串到64位变量，提供溢出检查、最大值限制，且不允许前导空格或符号，需由外围代码显式处理。虽然可能稍慢于标准函数，但提升了代码严格性和安全性。
- **代码清理进展**：截至2025年11月12日，curl源码已完全移除`atoi`和`strtol`等弱函数调用，改用自定义函数，减少了代码重复并通过`curlx`前缀共享库和工具代码。
