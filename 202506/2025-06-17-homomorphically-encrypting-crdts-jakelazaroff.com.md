# Homomorphically Encrypting CRDTs | jakelazaroff.com
- URL: https://jakelazaroff.com/words/homomorphically-encrypted-crdts/
- Added At: 2025-06-17 14:18:14

## TL;DR


本文探讨了通过同态加密保护CRDT的敏感数据，实现在无需信任第三方服务器的情况下安全同步。同态加密允许服务器直接处理加密数据，但面临密钥规模庞大、运算效率极低及结构固定化的挑战。当前虽可结合安全协议或优化算法探索解决方案，但该技术在隐私保护与实用性间仍需平衡。

## Summary


这篇文章探讨了如何通过同态加密技术保护CRDT（无冲突复制数据类型）的敏感数据，使其能够在无需信任第三方服务器的情况下安全同步。以下是核心内容总结：

**问题背景**：  
使用CRDT进行协作文档编辑时，若需保密内容，传统端到端加密会导致服务器无法自动合并更新，用户必须同时在线。同态加密（Homomorphic Encryption）允许服务器在不解密数据的情况下直接处理加密数据，解决这一限制。

**同态加密基础**：  
- **定义**：允许在加密数据上执行计算，解密后结果与明文直接计算一致。  
- **类型**：  
  - 部分同态（仅支持加法或乘法）；  
  - 部分同态/层次同态（支持加减乘除但受限于操作次数）；  
  - 全同态（支持无限次加减乘除）。  
- **挑战**：运算会产生“噪音”，需通过“屏蔽”技术减少噪音以保证解密准确性。

**技术实现案例**：  
以Rust的TFHE-rs库实现同态加密的“最后写入获胜（LWW Register）”CRDT：  
1. **密钥管理**：客户端生成密钥对（客户端密钥+服务器密钥），加密数据后发送至服务器。  
2. **CRDT结构**：  
   - 包含Peer ID、Clock（版本钟）、Value（数据值），加密为密文。  
   - 合并逻辑需确保不泄露分支信息：通过加密条件选择（`select`方法）统一更新所有字段，避免分支判断暴露数据关系。  
3. **性能对比**：加密合并操作需1秒，而明文仅需0.5纳秒，凸显运算效率瓶颈。

**技术限制**：  
1. **密钥规模问题**：  
   - 示例中32字节CRDT需27MB服务器密钥；大规模数据可能需GB级别密钥。  
2. **性能问题**：全同态加密运算速度极低，加密CRDT操作比明文慢数亿倍。  
3. **固定结构约束**：  
   - CRDT需按“最坏情况”设计（如固定密钥数量的映射表），无法稀疏存储，导致存储和计算过度消耗。

**未来方向**：  
尽管面临挑战，研究者正探索多种解决方案：  
- 结合安全协议与CRDT（如加密即时通讯+CRDT合并）；  
- 开发专用结构如安全CRDT，或利用访问控制机制（如KeyHive项目）；  
- 优化算法降低密钥规模和计算复杂度。  

文章指出，同态加密虽能实现隐私保护，但当前仍受限于技术瓶颈，需进一步研究以平衡安全性与实用性。
