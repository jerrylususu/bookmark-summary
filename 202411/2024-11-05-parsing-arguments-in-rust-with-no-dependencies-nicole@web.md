# Parsing arguments in Rust with no dependencies | nicole@web
- URL: https://ntietz.com/blog/parsing-arguments-rust-no-deps/?utm_source=atom&utm_medium=feed
- Added At: 2024-11-05 13:35:50
- [Link To Text](2024-11-05-parsing-arguments-in-rust-with-no-dependencies-nicole@web_raw.md)

## TL;DR
文章讲述了作者与朋友合作时选择实现命令行参数解析器的过程，决定从零开始编写以深入学习。通过设计简单的解析器结构，实现位置参数和命名参数的支持，并详细描述了实现细节。尽管缺少部分功能，但无依赖的好处包括减少编译时间和bug，建议更多项目从零构建以减少依赖。

## Summary
1. **项目背景**：
   - 与朋友Emily合作时，面临两种选择：开始新功能或添加命令行参数解析器。
   - 最终选择实现命令行参数解析器，因为它是一个必须完成的任务，且边界更明确。

2. **从零开始**：
   - 决定从头编写解析器，而不是使用现有库，以深入学习。
   - 发现这是一个有深度的项目，适合学习和实践。

3. **Rust项目动机**：
   - 通过写诗练习，想写一个小工具生成提示，需要可配置的命令行参数。
   - 考虑使用`clap`库，但会增加23个依赖项，启用某些功能后依赖项增至38个。
   - 决定再次自己实现解析器，保持项目轻量，减少依赖，便于理解和维护。

4. **设计思路**：
   - 解析器设计简单，分为位置参数和命名参数。
   - 位置参数作为剩余字符串列表处理，无需特殊处理。
   - 命名参数支持短选项和长选项，如`-p`和`--port-number`。
   - 提供帮助文本和参数是否必需的选项。
   - 支持标志、单值和多值操作。

5. **实现细节**：
   - 使用结构体`Opt`表示每个选项，定义方法方便设置字段。
   - 使用枚举`Action`表示操作类型，如`Set`、`Append`、`SetTrue`、`SetFalse`。
   - 使用枚举`Value`表示解析后的值，如单值、多值和布尔值。
   - 结构体`Opts`包含所有选项，结构体`Matches`存储解析结果。

6. **解析实现**：
   - 在`Opts`上实现`parse`方法，处理命令行参数。
   - 使用`populate_defaults`方法设置默认值。
   - 使用`find_opt`方法查找匹配的选项，处理错误。
   - 主解析循环中，处理命名选项和位置参数，根据操作类型设置值。

7. **未完成功能**：
   - 缺少帮助和版本信息打印。
   - 缺少验证帮助。
   - 未在根模块中导出，使用不便。

8. **无依赖的好处**：
   - 减少编译时间，保持项目轻量。
   - 减少bug表面区域，避免第三方依赖问题。
   - 可能缺少部分功能，如Unicode支持，但可以通过Cargo特性可选添加依赖。

9. **总结**：
   - 建议更多项目从零开始构建，减少依赖，深入理解问题空间。
   - 无依赖项目可以减少传递依赖，保持`Cargo.lock`文件简洁。
