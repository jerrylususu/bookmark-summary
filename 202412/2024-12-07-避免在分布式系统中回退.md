# 避免在分布式系统中回退
- URL: https://aws.amazon.com/cn/builders-library/avoiding-fallback-in-distributed-systems/
- Added At: 2024-12-07 08:44:28
- [Link To Text](2024-12-07-避免在分布式系统中回退_raw.md)

## TL;DR
文章讨论了故障处理策略中的回退问题，指出回退策略难以测试且可能失败，建议提高主系统可靠性而非依赖回退。作者Jacob Gabrielson是AWS高级首席工程师，强调避免回退以减少操作混乱。

## Summary
1. **故障处理策略**：
   - **重试**：在失败后立即或延迟后再次尝试执行活动。
   - **主动重试**：并行多次执行活动，利用第一个完成的活动。
   - **故障转移**：在不同的终端节点副本上再次执行活动，或并行执行多个副本以提高成功几率。
   - **回退**：使用不同的机制来获得相同的结果。

2. **回退策略的问题**：
   - **难以测试**：回退逻辑难以在生产环境中准确模拟和测试。
   - **可能失败**：回退策略本身可能失败，无法提供预期的可靠性。
   - **加剧问题**：回退策略可能使问题更加严重，增加恢复时间。
   - **不值得冒险**：回退策略通常需要权衡，可能不值得冒风险。
   - **潜在错误**：回退逻辑中的错误可能在长时间后才显现，难以修复。

3. **单台计算机回退**：
   - **内存分配失败**：常见策略是让应用程序崩溃，因为内存不足可能导致计算机崩溃。
   - **回退逻辑问题**：回退逻辑难以测试，可能失败，且可能引入不可预测的负载。
   - **关键应用的解决方案**：在启动时预分配所有堆内存，避免依赖malloc。

4. **分布式回退**：
   - **更难测试**：分布式系统中的回退策略更复杂，涉及多台计算机和下游服务。
   - **可能失败**：回退策略可能提高成功几率，但无法保证成功。
   - **加剧中断**：回退策略可能扩大故障影响范围，增加恢复时间。
   - **不值得冒险**：回退策略通常需要权衡，可能不值得冒风险。
   - **潜在错误**：回退逻辑中的错误可能在长时间后才显现，难以修复。

5. **Amazon的回退替代方案**：
   - **提高非回退案例的可靠性**：投资于提高主要代码的可靠性，使用高可用性数据库。
   - **让调用者处理错误**：让调用系统处理故障，如通过重试。
   - **主动推送数据**：减少移动部件，如将数据推送到需要数据的系统。
   - **将回退转换为故障转移**：在生产环境中定期执行回退逻辑，确保其可靠性。
   - **确保重试和超时不会成为回退**：监控重试率，使用主动重试避免额外负载。

6. **结论**：
   - **避免回退**：回退策略难以证明和测试，可能引入操作模式，增加混乱。
   - **提高主系统可用性**：专注于提高主系统的可用性，避免在关键时刻冒失败风险。
   - **频繁执行回退**：如果回退至关重要，在生产环境中尽可能频繁地执行，确保其可靠性和可预测性。

7. **作者简介**：
   - **Jacob Gabrielson**：AWS高级首席工程师，在Amazon工作17年，主要负责内部微服务平台和EC2、ECS相关工作。

8. **相关内容**：
   - **超时、重试和抖动回退**
   - **缓存挑战和策略**
