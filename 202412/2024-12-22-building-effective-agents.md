# Building effective agents
- URL: https://www.anthropic.com/research/building-effective-agents
- Added At: 2024-12-22 07:12:22

## TL;DR
Anthropic分享了构建大型语言模型代理的经验，强调简单、可组合的模式，建议从简单解决方案开始，逐步增加复杂性，并提供了实用的构建块和模式组合建议。

## Summary
1. **背景与目标**：
   - 过去一年，Anthropic与多个行业的团队合作，构建大型语言模型（LLM）代理。
   - 最成功的实现并非依赖复杂的框架或专用库，而是使用简单、可组合的模式。
   - 本文分享了从客户和自身实践中获得的见解，并提供开发者构建有效代理的实用建议。

2. **代理的定义**：
   - **代理**可以有多种定义，有些客户将其视为完全自主的系统，而有些则将其描述为遵循预定义工作流的系统。
   - Anthropic将这些变体分类为**代理系统**，并区分了**工作流**和**代理**：
     - **工作流**：通过预定义的代码路径协调LLM和工具的系统。
     - **代理**：LLM动态指导其过程和工具使用的系统，保持对任务完成方式的控制。

3. **何时使用代理**：
   - 在构建LLM应用时，建议从最简单的解决方案开始，仅在必要时增加复杂性。
   - 代理系统通常以延迟和成本换取更好的任务性能，需权衡利弊。
   - 对于复杂任务，工作流提供可预测性和一致性，而代理则更适合需要灵活性和模型驱动决策的场景。

4. **框架的使用**：
   - 有许多框架简化了代理系统的实现，如LangGraph、Amazon Bedrock的AI Agent框架、Rivet和Vellum。
   - 这些框架简化了低级任务，但也增加了抽象层，可能导致调试困难。
   - 建议开发者从直接使用LLM API开始，并在使用框架时确保理解底层代码。

5. **构建块、工作流和代理**：
   - **增强型LLM**：代理系统的基本构建块是带有增强功能的LLM，如检索、工具和记忆。
   - **提示链**：将任务分解为一系列步骤，每个LLM调用处理前一个步骤的输出。
   - **路由**：将输入分类并引导到专门的后续任务，适用于复杂任务中的不同类别。
   - **并行化**：LLM可以同时处理任务，分为**分段**和**投票**两种变体。
   - **协调器-工作者**：中央LLM动态分解任务，委派给工作者LLM，并综合结果。
   - **评估器-优化器**：一个LLM生成响应，另一个提供评估和反馈，形成循环。
   - **代理**：随着LLM能力的成熟，代理在生产中逐渐出现，能够处理复杂任务，但实现通常简单。

6. **模式组合与定制**：
   - 这些构建块不是固定的，开发者可以根据不同用例进行组合和定制。
   - 成功的关键在于测量性能并迭代实现，仅在明显改善结果时增加复杂性。

7. **总结**：
   - 在LLM领域，成功的关键在于构建适合需求的系统，而不是最复杂的系统。
   - 从简单的提示开始，通过全面评估进行优化，仅在简单解决方案不足时引入多步骤代理系统。

8. **实现代理的核心原则**：
   - **保持简单**：在代理设计中保持简单性。
   - **优先透明**：明确展示代理的规划步骤。
   - **精心设计代理-计算机接口（ACI）**：通过详细的工具文档和测试来实现。

9. **附录1：代理的实际应用**：
   - **客户支持**：结合聊天机器人界面和工具集成，适用于需要对话和行动的任务。
   - **编码代理**：在软件开发领域，代理能够解决复杂的编码问题，通过自动化测试进行验证。

10. **附录2：工具的提示工程**：
    - 无论构建何种代理系统，工具都可能是重要组成部分。
    - 工具的定义和规范应与整体提示一样受到重视，建议通过示例、边缘案例和清晰的边界来优化工具的使用。
