# A black cat in 2032 bytes
- URL: https://evanhahn.com/light-switch/
- Added At: 2024-12-27 14:14:45
- [Link To Text](2024-12-27-a-black-cat-in-2032-bytes_raw.md)

## TL;DR
作者为Taper杂志创作了名为“Light Switch”的作品，通过图像压缩、数据URL嵌入、动画效果和代码优化等技术手段，将作品控制在2048字节以内。作品核心是一只黑猫，通过多次优化和调整，最终实现了生动的眨眼效果和灯光控制。作者感谢了合作伙伴、Taper团队和猫咪Kyppie的贡献。

## Summary
1. **项目背景**：
   - **Taper杂志**：Taper是一个在线文学杂志，专注于小型计算作品，要求提交的作品不超过2048字节。
   - **提交作品**：作者向Taper的第13期提交了名为“Light Switch”的作品，本文详细描述了创作过程。

2. **图像压缩**：
   - **原始图像**：作品的核心是一只黑猫，原始照片大小为2.5MB，远超过限制。
   - **压缩过程**：
     - **背景去除**：使用iOS的“lift a subject”功能去除背景。
     - **颜色简化**：使用Squoosh将图像颜色简化为黑白，并缩小尺寸至200×193。
     - **细节调整**：在JS Paint中进行微调，如修复眼睛的细节。
     - **最终压缩**：使用Zopfli工具进一步压缩，最终图像大小为502字节。

3. **图像嵌入**：
   - **数据URL**：由于无法加载外部资源，作者使用base64编码的数据URL将图像嵌入HTML中，数据URL长度为694字节。
   - **优化尝试**：作者考虑过使用其他图像格式（如GIF或WebP）或更高效的二进制数据存储方式，但最终未实施。

4. **动画效果**：
   - **眨眼效果**：为了让猫更生动，作者使用`<canvas>`元素实现了眨眼效果，通过四个黑色圆圈模拟眼皮的运动。
   - **细节优化**：增加了偶尔的快速眨眼，使效果更自然。

5. **灯光控制**：
   - **背景问题**：由于猫的眼睛是透明的，改变背景颜色会影响眼睛的颜色。
   - **解决方案**：在眼睛后面添加黄色方块，确保在黑暗中眼睛仍然可见。

6. **代码优化**：
   - **JavaScript压缩**：使用Terser压缩JavaScript代码，并通过以下技巧进一步减少字节数：
     - 使用元素ID代替完整选择器。
     - 使用`let`代替`const`。
     - 使用箭头函数代替传统函数声明。
     - 使用`el.onclick`代替`el.addEventListener`。
     - 使用`7`代替`2 * Math.PI`。

7. **致谢**：
   - **合作伙伴**：感谢伴侣的建议和帮助。
   - **Taper团队**：感谢Taper团队的努力。
   - **猫咪Kyppie**：感谢猫咪Kyppie的“出演”。

8. **资源链接**：
   - **源代码**：作品的源代码可在[此处](https://git.sr.ht/~evanhahn/light-switch)查看。
   - **Taper网站**：可以在[Taper网站](https://taper.badquar.to/13/)查看其他优秀作品。
