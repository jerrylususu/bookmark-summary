# "Rules" that terminal programs follow
- URL: https://jvns.ca/blog/2024/11/26/terminal-rules/
- Added At: 2024-12-13 16:42:15
- [Link To Text](2024-12-13-rules-that-terminal-programs-follow_raw.md)

## TL;DR
文章讨论了终端程序的职责划分和常见行为规则，包括响应`Ctrl-C`、`q`、`Ctrl-D`等操作，使用16种颜色，支持readline键绑定等。这些规则描述了程序的常见行为，但并非强制标准，用户需逐步学习并识别例外。

## Summary
1. **终端程序的职责划分**：终端中的所有操作可以归结为以下四个部分的组合：
   - **操作系统**
   - **Shell**
   - **终端模拟器**
   - **正在运行的程序**（如`top`、`vim`、`cat`等）

2. **行为一致性**：尽管没有明确的终端程序行为标准，但大多数程序在终端中的行为相对一致。

3. **描述性而非规定性**：这些“规则”旨在描述程序的常见行为，而非强制要求程序开发者遵循。

4. **职责不明确**：有时难以确定某些“规则”是否应由程序实现，例如`Ctrl-D`退出REPL的行为。

5. **规则1：非交互式程序应响应`Ctrl-C`退出**：
   - 非交互式程序默认会在`Ctrl-C`时退出，除非设置了`SIGINT`信号处理器。
   - 交互式程序（如`python3`、`less`）不会在`Ctrl-C`时退出，而是中断当前操作。

6. **规则2：TUI程序应响应`q`退出**：
   - TUI程序（如`less`、`htop`）通常会在按下`q`时退出。
   - 不适用于`tmux`或文本编辑器等程序。

7. **规则3：REPL应响应`Ctrl-D`在空行时退出**：
   - REPL（如`python3`、`ed`）通常会在空行时按下`Ctrl-D`退出。
   - 大多数REPL实现了这一行为，尽管它们不使用“cooked mode”。

8. **规则4：不要使用超过16种颜色**：
   - 终端程序通常只使用16种基本ANSI颜色，以避免与用户终端背景颜色冲突。
   - 例外包括某些文本编辑器（如Helix），它们使用自定义颜色方案。

9. **规则5：模糊支持readline键绑定**：
   - 大多数程序支持`readline`键绑定（如`Ctrl-E`移动到行尾），尽管它们并不直接使用`readline`库。
   - 例外包括`git`、`cat`等程序，它们不支持复杂的行编辑功能。

10. **规则5.1：`Ctrl-W`应删除最后一个单词**：
    - 几乎所有程序（除文本编辑器外）都支持`Ctrl-W`删除最后一个单词。

11. **规则6：写入管道时禁用颜色**：
    - 大多数程序在写入管道时会禁用颜色输出，如`rg`和`ls`。
    - 可以通过`unbuffer`或`--color=always`强制启用颜色。

12. **规则7：`-`表示stdin/stdout**：
    - 大多数程序在传递`-`作为文件名时，会从stdin读取或写入stdout。
    - 例如，`pbpaste | black - | pbcopy`可以将剪贴板中的Python代码格式化并复制回去。

13. **学习这些规则需要时间**：
    - 用户需要逐步学习这些规则，并识别例外情况，最终形成明确的理解。
