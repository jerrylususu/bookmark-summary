# Solving NYT's Pips Puzzle
- URL: https://healeycodes.com/solving-nyt-pips-puzzle
- Added At: 2025-10-18 14:13:07
- [Link To Text](2025-10-18-solving-nyt's-pips-puzzle_raw.md)

## TL;DR
本文介绍了作者开发的《纽约时报》Pips 拼图求解器，包括游戏规则、深度优先搜索算法实现，以及通过剪枝、骨牌方向重复跳过和智能区域检查等优化手段，将节点数从21337降至1355，并实现交互式界面。

## Summary
本文介绍了作者为《纽约时报》的 Pips 拼图游戏开发的求解器，涵盖游戏规则、求解器实现、优化策略以及 UI 设计。

### 游戏背景
Pips 是一款每日拼图游戏，玩家需将多米诺骨牌放置在非矩形网格板上，并满足区域限制条件，包括：
- **求和**：区域内所有格子的点数之和必须等于目标值。
- **相等**：区域内所有格子的点数必须相同。
- **不等**：区域内所有格子的点数必须不同。
- **小于/大于**：区域内所有格子的点数之和必须小于或大于目标值。

### 求解器实现
作者使用 TypeScript 定义了游戏数据结构（如格子坐标、骨牌类型、区域规则），并采用深度优先搜索（DFS）算法遍历合法状态树。核心步骤包括：
1. **构建邻接表**：确定每个格子的相邻格子，用于骨牌放置。
2. **递归搜索**：依次尝试放置每个骨牌（包括正反两种方向），若违反区域规则则回溯。
3. **区域检查**：在搜索过程中实时验证区域限制，提前剪枝非法分支。

初始暴力搜索求解 Hard/16/20/25 谜题需检查 21337 个节点，耗时约 35 毫秒。

### 优化策略
通过以下优化，求解效率提升约 16 倍（节点数降至 1355）：
1. **跳过重复骨牌方向**：对于点数相同的骨牌（如 `3|3`），避免重复搜索对称方向，节点数从 21337 降至 7618。
2. **检查孤立空单元格**：若放置骨牌后产生无相邻空格的格子（即无法放置骨牌另一半），立即剪枝，节点数从 7618 降至 5777。
3. **智能区域检查**：在区域未完全填充时，根据剩余骨牌判断是否可能满足规则（如“相等”区域需有足够相同点数骨牌），节点数从 5777 降至 1355。

作者尝试了移动排序优化但未成功，认为此类瓷砖拼图的特性可能导致传统排序方法失效。

### UI 设计与挑战
- **交互界面**：使用 React 开发了仿 NYT 的拼图界面，包含棋盘和搜索树可视化（通过 Canvas 绘制）。
- **问题解决**：
  - 跟踪骨牌关系：初始实现仅处理单个格子，后改为记录骨牌配对关系。
  - 性能优化：通过缓冲更新和帧率控制避免 Canvas 频繁重绘。

代码已开源，集成在作者网站中。整体工作展示了如何通过算法优化和交互工具高效解决复杂拼图问题。
