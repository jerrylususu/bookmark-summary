# Designing agentic loops
- URL: https://simonwillison.net/2025/Sep/30/designing-agentic-loops/
- Added At: 2025-10-02 13:47:43
- [Link To Text](2025-10-02-designing-agentic-loops_raw.md)

## TL;DR
智能体循环是利用大型语言模型通过循环运行工具实现代码生成目标的关键技能。需在安全沙盒中运行，管理凭证风险，并选择明确任务场景，以最大化效率与安全性。

## Summary
文章主题是“设计智能体循环”，核心观点为在利用大型语言模型（如Claude Code和Codex CLI）进行代码生成时，如何通过精心设计智能体循环来最大化其效率。以下是结构化总结：

---

**一、智能体循环的定义与重要性**  
智能体循环指大型语言模型通过循环运行工具来实现目标的过程。现代代码智能体能直接执行代码、修正错误、查找实现细节并运行实验，但需要合理设计循环和工具才能发挥潜力。这是一种新兴的关键技能。

**二、YOLO模式的风险与应对策略**  
YOLO模式（默认批准所有操作）能提高效率，但极具风险，包括：  
1. 恶意命令导致数据丢失或系统损坏。  
2. 数据泄露（如源代码或环境变量中的密钥）。  
3. 机器被用作代理攻击其他目标。  

**应对策略**：  
1. 在安全沙盒（如Docker或Apple容器工具）中运行智能体。  
2. 使用他人计算机（如GitHub Codespaces），限制损害范围。  
3. 冒险尝试，但需尽量避免暴露于恶意指令。  
多数人选择策略3，但作者推荐策略1或2，并强调限制网络访问（如仅允许信任主机）可减少泄露风险。

**三、工具选择与配置**  
智能体擅长使用Shell命令，无需过度依赖MCP（Model Context Protocol）。建议：  
1. 通过AGENTS.md等文件明确工具使用示例（如shot-scraper命令行）。  
2. 允许智能体从NPM、PyPI等安装包，但需确保环境隔离以避免破坏主系统。  
3. 智能体通常能自学工具使用（如playwright、ffmpeg），并通过循环修正错误。

**四、凭证管理的最佳实践**  
涉及认证时需谨慎：  
1. 优先提供测试或预发布环境的凭证，限制损害范围。  
2. 如果凭证涉及资金，设置严格预算（如5美元）。  
示例：作者为调查Fly.io应用启动时间，创建独立组织并设置预算，允许Claude Code直接部署和测试。

**五、适用场景**  
智能体循环适用于符合以下条件的任务：  
- 有明确成功标准。  
- 需通过试错寻找解决方案。  
具体场景包括：  
- 调试（如测试失败分析）。  
- 性能优化（如SQL查询索引调整）。  
- 依赖升级（需配套测试套件）。  
- 容器大小优化（迭代Dockerfile）。  
自动化测试能极大提升智能体效果，LLM也可辅助创建测试套件。

**六、结论与展望**  
设计智能体循环是2025年新兴技能（Claude Code于2025年2月发布），仍需更多探索。命名该技能有助于推动讨论，未来需进一步研究如何高效使用这些工具。
