# Every Line Is a Potential Bug
- URL: https://www.teamten.com/lawrence/writings/every_line_is_a_potential_bug.html
- Added At: 2025-03-08 11:46:11

## TL;DR
文章通过案例说明过度优化和代码复杂性可能引发潜在错误。原始代码虽简单但正确，评审提议动态计算等待时间时，两次修改均引入缺陷（如负数等待或无限期等待）。作者强调代码复杂性与Bug直接相关，主张仅在必要时使用最简方案，抵制冗余优化和过度设计。

## Summary
该文章通过一个实际编程案例阐述了过度优化和不必要的代码复杂性可能引入潜在错误的观点：  
1. **原始代码逻辑**：  
   - 使用循环等待消息从哈希表中获取，设置超时时间为5秒，每次等待1秒后检查超时。  
   - 该代码简单且功能正确，允许最大1秒超时误差，但未引发严重问题。  

2. **评审的修改提议**：  
   - 评审认为应动态计算剩余等待时间而非固定1秒，以减少不必要的线程切换。  
   - 两人修改代码均引入错误：  
     - 第一个修改直接使用了错误常量，逻辑明显错误。  
     - 第二个修改通过`timeoutTime - 当前时间`计算等待时间，因时间戳可能跳过导致负数（引发异常）或结果为0（无限期等待），形成隐蔽缺陷。  

3. **作者核心观点**：  
   - **代码复杂性与潜在Bug的关联**：每行新增代码都可能成为Bug来源，优化若增加复杂性应被避免。  
   - **抵制不必要的代码**：  
     - 不要编写“可能用得上”的冗余代码或抽象层。  
     - 即使简单操作（如减法）也应谨慎，因微小复杂度可能在长远导致难以排查的问题。  
   - **编程哲学**：仅在必要时编写最简易的解决方案，避免“未陷入困境前的提前优化”。
