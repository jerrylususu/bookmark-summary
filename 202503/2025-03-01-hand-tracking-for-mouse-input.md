# Hand Tracking for Mouse Input
- URL: https://chernando.com/blog/2023/07/23/hand-tracking-for-mouse-input.html
- Added At: 2025-03-01 10:10:38

## TL;DR
本文作者尝试使用手势控制鼠标输入，通过MediaPipe检测手部位置，Python模拟鼠标操作，解决了延迟、抖动等问题，最终实现了类似Apple Vision Pro的手势控制鼠标功能，代码开源。

## Summary
1. **项目背景**：
   - 作者在看到Apple Vision Pro发布后，对其手指捏合输入方式产生兴趣，决定尝试实现类似的手势控制鼠标输入。

2. **目标设定**：
   - 使用手作为输入设备，控制鼠标点击和移动。
   - 需要摄像头、手部和手指位置检测、以及模拟鼠标输入的方法。

3. **技术选择**：
   - 使用Google的MediaPipe进行手部和手指位置的检测。
   - 使用Python进行鼠标输入的模拟。

4. **初次尝试**：
   - 使用Python版的MediaPipe和OpenCV，但发现存在严重的延迟问题。
   - 研究发现问题与OpenCV的`waitKey`函数有关，暂时未找到解决方法。

5. **改进思路**：
   - 发现MediaPipe的Web版本运行更流畅，决定转而使用Web版。
   - 提出通过浏览器前端与Python后端通信的方案，使用WebSocket实现实时通信。

6. **鼠标模拟实现**：
   - WebSocket服务器接收包含x和y坐标的JSON消息，控制鼠标移动。
   - 使用拇指尖的坐标作为鼠标移动的输入。
   - 通过检测拇指和食指的捏合动作实现鼠标点击，使用欧几里得距离判断捏合状态。

7. **问题与解决方案**：
   - **距离问题**：当手靠近摄像头时，手指间距离变大，导致点击判断失效。解决方案是使用手指尖与指节间的相对距离。
   - **抖动问题**：手部静止时鼠标光标仍然抖动，通过移动平均法平滑光标移动，但会增加延迟。
   - **边缘问题**：光标移动到屏幕边缘时手部不再完全可见，通过线性变换增加边缘的填充解决。

8. **进一步优化**：
   - 使用Tauri框架将Web前端与Rust后端结合，实现更高效的鼠标输入模拟，并解决浏览器标签必须保持打开的问题。

9. **扩展功能**：
   - 增加前向摄像头模式，用户可以通过指向屏幕来控制光标。
   - 需要计算手指指向的角度和手指与摄像头之间的距离，使用三角函数和比例计算光标位置。

10. **前向模式的问题**：
    - **抖动问题**：前向模式下光标抖动严重，即使使用移动平均法也无法完全解决。
    - **过滤方案**：引入One Euro滤波器进一步减少抖动，但仍然存在一些抖动和光标漂移问题。

11. **结论与项目总结**：
    - 项目成功实现了类似Apple Vision Pro和Meta Quest的手势控制鼠标输入。
    - 下向摄像头模式表现较为稳定，而前向摄像头模式由于模型本身的限制，仍存在抖动和不稳定的问题。
    - 项目使用了MediaPipe、Tauri、Rust等技术，代码可在GitHub上找到。
