# Booleans Are a Trap
- URL: https://katafrakt.me/2024/11/09/booleans-are-a-trap/
- Added At: 2025-03-22 13:31:14
- [Link To Text](2025-03-22-booleans-are-a-trap_raw.md)

## TL;DR


布尔值因简洁性常被滥用，但会引发领域模型复杂度激增（如门、企业模型因布尔组合导致非法状态激增）。改用枚举（如DoorState）与集合替代，配合状态机定义流转规则，可有效减少无效状态并简化维护，作者建议将布尔值限于技术层，领域层优先采用枚举和状态机管理复杂业务逻辑。

## Summary


开发者虽钟爱布尔值因其简洁性和与计算机底层逻辑的契合，但过度用于领域建模会引发复杂问题。布尔值看似简单，却因需求变化导致状态爆炸。例如用布尔值表示门的开闭（isOpen）和上锁（isLocked），理论上会产生四种状态，但“开且锁”在现实中不合理，代码仍需处理非法状态。类似问题出现在企业付费状态模型中，初始的isPaying布尔值随新增免费合作伙伴（isPartner）、AI功能开关（isAIEnabled）等布尔标志，最终衍生出4096种可能状态，仅20种有效，显著增加代码复杂度。

改进方案建议使用枚举（enum）和集合替代布尔组合。门状态改用DoorState枚举（Open/Closed/Locked）直接限定有效状态；企业合同状态通过ContractStatus枚举（Trial/Paying/Partner）规范状态转移，并用PremiumFeature集合管理增值功能。此方法虽无法完全消除非法状态（如试用期公司启用高级功能），但大幅减少状态数量，测试和维护更易。作者强调布尔值应限定于技术层（如集合的hasElement方法），领域模型需优先考虑枚举和状态机，因其更贴近现实复杂性。状态机可基于枚举定义状态流转规则，虽需权衡业务灵活性，但能提前规避布尔陷阱。
