# Model Context Protocol has prompt injection security problems
- URL: https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/
- Added At: 2025-04-09 14:26:23

## TL;DR


该文指出Model Context Protocol（MCP）存在多重安全漏洞：可信工具可能通过静默重定义、跨服务器覆盖或隐藏指令窃取隐私（如WhatsApp数据窃取案例），源于工具与LLM交互的不可信输入暴露及客户端UI设计缺陷。建议通过工具变更提醒、权限限制、用户教育等多维度改进，但目前仍缺乏可靠防御手段，需持续优化。

## Summary


文章探讨了Model Context Protocol（MCP）中存在的提示注入安全漏洞及其潜在风险。主要结构如下：

### 核心问题概述  
- **MCP角色定义**：客户端（如Claude Desktop）集成LLM和工具，服务器（本地程序）提供工具功能。  
- **安全挑战**：工具与LLM的交互存在“困惑副官攻击”风险，即攻击者通过可信工具执行恶意操作。

---

### 安全漏洞类型  
1. ** Rug Pulls & Tool Shadowing（工具覆盖与劫持）**  
   - **静默重定义**：已安装工具可篡改自身功能，导致API密钥被盗。  
   - **跨服务器覆盖**：恶意服务器可能拦截或篡改可信服务器的调用。  

2. **Tool Poisoning（工具投毒攻击）**  
   - 恶意指令隐藏在工具描述中，LLM读取后触发敏感操作（如读取`~/.cursor/mcp.json`并发送给攻击者）。  
   - 示例：`add()`工具要求提供`sidenote`参数，包含用户隐私数据。

3. **WhatsApp数据窃取案例**  
   - 攻击者通过恶意工具`get_fact_of_the_day()`替换自身描述，篡改`send_message()`的调用逻辑，窃取消息历史记录。  
   - 技巧：利用大量空白字符隐藏关键信息，绕过用户界面的可视限制。

4. **不可信指令与工具的混合风险**  
   - 即使无恶意服务器，单个工具（如WhatsApp的`list_chats()`）也可能被外部提示（如收到的恶意信息）触发，导致数据泄露。  
   - 恶意指令可能指示LLM加密或用空白字符掩盖数据，增加检测难度。

---

### 漏洞根源  
- **协议无关性**：漏洞本质并非MCP的缺陷，而是工具与LLM交互时对不可信输入的暴露。  
- **UI设计漏洞**：多数客户端不提示工具描述变更，用户无法察觉工具行为变化。

---

### 应对建议  
- **客户端**：  
  - 监控工具描述变更并通知用户。  
  - 避免隐藏关键信息（如禁用水平滚动条）。  
- **服务器开发者**：  
  - 避免危险操作（如`os.system()`）；限制工具权限。  
  - 确保用户能识别和阻止高风险操作（如关键敏感数据外发）。  
- **用户**：  
  - 谨慎安装工具，警惕工具组合的安全性。  

---

### 总结困境  
- 提示注入问题已存在2.5年，仍缺乏可靠防御手段。  
- 作者对MCP安全化进程信心不足，但认为工具化（如自身项目LLM）仍是重要方向。  
- 需在UI设计、权限控制及用户教育多方面协同改进。
