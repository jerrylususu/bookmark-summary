# Code Review Hot Spots with Semgrep
- URL: https://parsiya.net/blog/2022-04-07-code-review-hot-spots-with-semgrep/
- Added At: 2025-04-12 12:55:14
- [Link To Text](2025-04-12-code-review-hot-spots-with-semgrep_raw.md)

## TL;DR


文章介绍了通过Semgrep工具识别代码"热点"的方法。热点是需人工审查的潜在漏洞区域（如不安全配置、危险函数），区别于可自动修复的明确漏洞。建议将静态分析规则分为低误报的"安全规则"和容许多误报的"热点规则"，结合工具（如Semgrep、CodeQL）与文档分析，辅以安全团队经验进行针对性审查，平衡自动化效率与人工判断需求。

## Summary


文章讨论了如何通过Semgrep工具识别和审查代码中的“热点”问题。热点指可能存在安全漏洞但不适合完全自动化的代码区域，需手动审查。主要内容如下：

---

### **热点的定义**
- 热点是可能存在安全漏洞的代码区域，但无法通过自动化完全检测，需人工介入。
- 实际审查中优先检查明显风险模式（如SSLv3、MD5等），而非特定漏洞。

---

### **静态分析规则分类**
1. **安全规则**：  
   - 直接检测特定漏洞（如日志注入），需0误报以确保开发者信任。
   - 适合集成到CI/CD或IDE中。

2. **热点规则**：  
   - 标识潜在风险区域，容许多误报，需人工快速筛选。
   - 与安全规则分开管理（如开发者使用安全规则，安全团队使用热点规则）。

---

### **现有工具及方法**
- **Semgrep规则**：  
  - 将“audit”规则置于`security`目录下可能导致误用，建议分离分类。
  - 示例规则：检查TLS 1.0配置、Go证书验证跳过、Java外部实体注入等。

- **Microsoft Application Inspector**：  
  - 通过关键词匹配识别功能特性（如密码学），但更适合特征分析而非手动审查。

- **Weggli**：  
  - Google的C/C++静态分析工具，规则基于Tree-Sitter，启发了Semgrep规则设计。

---

### **热点类型及示例**
1. **不安全配置**：  
   - 组件配置缺陷：如Go中TLSv1.0支持、跳过证书验证。
   - Docker安全配置问题（如以root运行、未固定镜像源）。

2. **危险函数**：  
   - 脆弱函数：MD5哈希（非加密场景可能安全）、C中的`sizeof(*ptr)`缓冲区溢出风险。
   - Go的`text/template`包（可能引发XSS）、`unsafe`包的使用。

3. **危险模式**：  
   - 拼接SQL查询（Java）、未验证PHP的`openssl_decrypt`返回值、硬编码敏感信息。

4. **关键词提示**：  
   - 与加密相关的函数名（如`encode/decode`）、注释中的`CVE`、`BUG`编号（如VS Code代码中的CVE-2021-1416引用）。

---

### **热点收集方法**
1. **静态规则分析**：  
   - 参考Semgrep审计规则、GitHub Security Lab的CodeQL查询。

2. **编码规范**：  
   - 禁用危险函数或库，收集遗留代码例外情况。

3. **文档与警告**：  
   - 语言官方文档中的安全警告（如PHP`unserialize`的风险提示）。

4. **经验积累**：  
   - 安全工程师基于历史漏洞总结关键筛查项。

---

### **核心观点**
- 热点审查是安全流程的关键环节，需结合工具规则与人工判断。
- 需区分自动修复的安全规则与需手动检查的热点规则，避免误报影响开发者信任。
