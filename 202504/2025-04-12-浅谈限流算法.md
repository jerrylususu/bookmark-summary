# 浅谈限流算法
- URL: https://leungyukshing.github.io/archives/Rate-Limit-Algorithm.html
- Added At: 2025-04-12 11:48:00
- [Link To Text](2025-04-12-浅谈限流算法_raw.md)

## TL;DR


接口限流算法保护服务器资源并防御攻击，常见方法包括时间桶（简单但难以应对突发）、漏桶（平滑流量但灵活性差）和GCRA（基于令牌桶改进，通过时间戳允许突发流量、支持动态调整）。GCRA因高效灵活成优选，但需根据场景（如突发需求、实时性）选择算法。

## Summary


本文探讨了接口限流算法在软件工程中的重要性及其实现方法，总结如下：

---

### **作用**
1. **保护服务器资源**：在流量高峰期限制对数据库等资源的访问，防止过载。
2. **安全防护**：通过限流抵御暴力破解等恶意攻击。

---

### **常见算法及其特点**

#### **1. 时间桶（计数器）算法**
- **原理**：使用 Redis 存储计数器，请求时检查剩余配额，用完即拒绝。
- **缺点**：无法应对突发流量，例如在时间窗口结束时集中发起大量请求会导致瞬间过载。

#### **2. 漏桶（Leaky Bucket）算法**
- **原理**：请求以恒定速率流出桶，超出容量则丢弃。
- **优点**：平滑流量波动，实现稳定处理。
- **缺点**：无法灵活应对突发流量高峰，处理效率较固定。

#### **3. GCRA（基于令牌桶的改进算法）**
- **核心机制**：通过时间戳（TAT）计算令牌可用性，避免存储复杂状态：
  - **TAT（理论到达时间）**：表示桶恢复填满所需的时间。
  - **计算方式**：当前时间 + 消耗令牌数 × 时间间隔，若超过上限（基于桶容量）则拒绝请求。
- **优点**：
  - 允许短时请求尖峰（利用桶的容量）。
  - 仅需存储时间戳，减少锁竞争和存储开销。
  - 动态调整限流参数后能立即生效。
- **灵活处理**：支持返回 `RetryAfter` 和 `ResetAfter`，为调用方提供重试建议。

---

### **总结**
限流算法的核心目标是平衡流量控制与系统稳定性。GCRA 算法通过时间戳机制优化了令牌桶的实现，解决了突发流量和动态调整的问题，是综合性能更优的选择。选择具体算法需根据实际场景（如是否允许突发、对实时性的要求等）进行权衡。
