# Stop syncing everything
- URL: https://sqlsync.dev/posts/stop-syncing-everything/
- Added At: 2025-04-09 14:11:50

## TL;DR


Graft是一个专为边缘设备和受限环境设计的开源交易性存储引擎，通过懒同步（基于优化位图）、部分数据读取和轻量化边缘分发实现高效同步，同时采用SSI模型确保强一致性。支持离线应用、跨平台数据共享及任意二进制数据，集成SQLite扩展并提供低资源消耗的解决方案，未来计划扩展WebAssembly支持与冲突处理策略。

## Summary


Graft 是一个开源的交易性存储引擎，旨在实现懒加载、部分同步、边缘友好的强一致数据复制。其核心设计针对边缘设备和受限环境，通过以下机制实现高效同步：

### **核心特性**
1. **懒同步（Lazy Sync）**  
   客户端可自主决定同步时间，通过 `graft` 获取自上次快照后的变更元数据（如修改的页面位图），无需立即下载全部数据。`graft` 采用优化的位图格式（Splinter），支持快速增量同步。

2. **部分同步（Partial Sync）**  
   客户端根据 `graft` 中的变更信息按需下载实际数据页，而非全量复制。支持三种预取策略：通用算法（Leap 算法）、领域知识驱动、及全量回滚。

3. **边缘友好（Edge-Native）**  
   数据页通过对象存储分发至全球边缘节点，供客户端缓存就近访问。客户端轻量级设计，适配浏览器、移动设备、无服务器等资源受限环境。

4. **强一致性（Serializable Isolation）**  
   采用序列化快照隔离（SSI）模型，确保全局事务一致性。处理冲突时，客户端需重新拉取最新快照或合并本地修改，避免数据分脑。

### **应用场景**
- **离线优先应用**：移动笔记、任务管理工具等，自动处理离线操作并同步冲突。
- **跨平台数据共享**：无缝同步多设备数据，避免厂商锁定。
- **无状态多写副本**：服务器或无服务器环境可快速启动只读副本，无需预加载全量数据。
- **任意数据类型**：支持 SQLite 数据库、Parquet 文件、地图瓦片等二进制或结构化数据。

### **技术实现**
- **Volume 架构**：数据存储为分片的固定大小页面（Page），版本通过快照（Snapshot）管理，仅持久化必要变更。
- **SQLite 扩展（libgraft）**：通过 SQLite 虚拟文件系统（VFS）拦截读写，实现透明集成，保持 SQLite 事务语义的同时支持远程复制和点时间恢复。

### **对比其他方案**
- **mvSQLite**：依赖 FoundationDB，不适合边缘设备；Graft 改用对象存储，元数据更紧凑。
- **Litestream**：仅单向备份，Graft 支持多写及按需读取。
- **cr-sqlite**：需依赖 CRDT 和模式感知，Graft 支持任意数据且无自动冲突解决。
- **Durable Objects + SQLite**：中心化服务，Graft 把数据推送到客户端嵌入。

### **路线图**
- **WebAssembly 支持**：实现浏览器端运行，集成 SQLSync。
- **扩展语言 SDK**：提供 Python/Go 等客户端库。
- **优化写入延迟**：探索本地缓冲或低延迟存储层。
- **垃圾回收与压缩**：减少存储冗余，提升性能。
- **冲突处理策略**：内置自动非重叠事务合并，支持应用层扩展。

### **参与与获取**
- 开源仓库：GitHub（[orbitinghail/graft](https://github.com/orbitinghail/graft)）
- 托管服务：加入等待列表获取早期访问权限
- 社区：通过 Discord 或邮件联系作者。
