# Introducing Netflix’s Key-Value Data Abstraction Layer
- URL: https://netflixtechblog.com/introducing-netflixs-key-value-data-abstraction-layer-1ea8a0a11b30
- Added At: 2024-09-19 14:59:51

## TL;DR
Netflix开发了基于Data Gateway Platform的KV数据抽象服务，以简化数据访问、增强基础设施可靠性，并支持广泛的使用案例。该服务采用两级映射架构，提供高可用性、可调一致性和低延迟，抽象了底层数据库的复杂性，使应用工程师专注于业务问题。未来计划包括生命周期管理、摘要技术和新存储引擎的集成。

## Summary
1. **引言**：
   - Netflix的全球后端基础设施是其提供无缝、高质量流媒体体验的关键。
   - 核心基础设施包括使用多个在线分布式数据库，如Apache Cassandra，用于用户注册、观看历史存储、实时分析和直播流支持。

2. **挑战**：
   - 随着新数据库的引入和服务的扩展，面临数据存储滥用的挑战。
   - 开发者难以理解一致性、持久性和性能。
   - 需要不断重新学习数据建模实践和数据访问模式。
   - 与多个原生数据库API的紧密耦合导致工程维护和优化困难。

3. **解决方案**：
   - 开发了基于Data Gateway Platform的综合方法。
   - 创建了多个基础抽象服务，其中最成熟的是Key-Value (KV) Data Abstraction Layer (DAL)。
   - 该抽象简化了数据访问，增强了基础设施的可靠性，并支持Netflix广泛的使用案例。

4. **KV数据抽象服务**：
   - 目标是构建一个多功能且高效的数据存储解决方案，处理从简单哈希表到复杂数据结构的各种用例。
   - 确保高可用性、可调一致性和低延迟。

5. **数据模型**：
   - 核心是两级映射架构。
   - 第一级是哈希字符串ID（主键），第二级是字节键值对的排序映射。
   - 支持简单和复杂数据模型，平衡灵活性和效率。

6. **数据库无关抽象**：
   - 设计隐藏底层数据库的实现细节，提供一致的接口。
   - 支持多种数据存储，如Cassandra、EVCache、DynamoDB、RocksDB等。

7. **命名空间配置**：
   - 命名空间定义数据存储位置和方式，提供逻辑和物理分离。
   - 每个命名空间可以使用不同的后端，如Cassandra、EVCache或组合。

8. **KV抽象的关键API**：
   - **PutItems**：写入一个或多个项目到记录。
   - **GetItems**：从一个记录中读取一个或多个项目。
   - **DeleteItems**：从一个记录中删除一个或多个项目。
   - **复杂操作API**：支持多项目和多记录的复杂操作。

9. **设计原则**：
   - **幂等性**：确保数据完整性，使用幂等性令牌。
   - **大数处理**：通过分块处理大数，确保系统可预测和高效。
   - **客户端压缩**：优化性能，减少服务器CPU使用、网络带宽和磁盘I/O。
   - **智能分页**：使用字节限制响应页面大小，提供可预测的操作SLO。
   - **信号机制**：动态配置客户端和服务器之间的设置和参数。

10. **Netflix中的KV使用**：
    - **流媒体元数据**：高吞吐量、低延迟访问流媒体元数据。
    - **用户配置文件**：高效存储和检索用户偏好和历史。
    - **消息传递**：存储和检索推送注册表。
    - **实时分析**：持久化大规模印象数据，提供用户行为和系统性能的洞察。

11. **未来增强**：
    - **生命周期管理**：细粒度控制数据保留和删除。
    - **摘要技术**：通过摘要记录提高检索效率。
    - **新存储引擎**：集成更多存储系统以支持新用例。
    - **字典压缩**：进一步减少数据大小同时保持性能。

12. **结论**：
    - KV服务是灵活、成本效益高的解决方案，支持广泛的数据模式和用例。
    - 抽象了底层数据库的复杂性，使应用工程师专注于解决业务问题。
    - 作为Netflix在线数据存储创新的核心组件，确保数据高效可靠地管理。
