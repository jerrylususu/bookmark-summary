# Cog
- URL: https://nedbatchelder.com/code/cog
- Added At: 2024-09-07 10:10:40
- [Link To Text](2024-09-07-cog_raw.md)

## TL;DR
Cog是一个文件生成工具，允许在源文件中嵌入Python代码片段生成文本。它通过标记行识别代码块并执行，输出直接写回文件。Cog设计易用，避免模板引擎限制，支持多种语言和紧凑形式。安装简单，功能丰富，支持多种命令行选项和模块调用。

## Summary
1. **Cog简介**：Cog是一个文件生成工具，允许在源文件中嵌入Python代码片段作为生成器，生成所需的文本。

2. **功能概述**：
   - **文件转换**：Cog通过查找嵌入的Python代码块，执行代码并将输出插入到原始文件中。
   - **标记行**：使用三重方括号标记行来标识Python代码块和其输出。
   - **输出方式**：使用`cog.outl`或`print()`（通过`-P`选项）输出文本。

3. **设计理念**：
   - **易用性**：Cog设计为易于运行，结果直接写回原始文件，支持多次运行。
   - **隐藏代码**：标记行可以包含任何文本，使Python代码块对源文件不可见。
   - **避免模板引擎**：直接使用Python的强大功能进行文本生成，避免模板引擎的限制。

4. **安装指南**：
   - **支持版本**：Python 2.7, 3.5-3.8, Jython 2.5。
   - **安装命令**：`pip install cogapp`。
   - **许可证**：MIT许可证。

5. **编写源文件**：
   - **标准Python代码**：源文件中的Python代码是标准的Python代码。
   - **生成器**：每个Python代码块称为一个生成器，按顺序执行。
   - **标记格式**：标记行格式无关紧要，只要包含特殊字符序列即可。
   - **多语言支持**：支持多种语言，如SQL文件中的示例。
   - **紧凑形式**：支持单行生成器的紧凑形式。

6. **Cog模块**：
   - **输出函数**：`cog.out`和`cog.outl`用于写入输出。
   - **消息和错误**：`cog.msg`和`cog.error`用于打印消息和抛出错误。
   - **文件属性**：提供输入和输出文件路径、行号等属性。

7. **运行Cog**：
   - **命令行工具**：支持标准命令行参数，如`-h`、`-c`、`-D`等。
   - **模块调用**：可以通过`python -m cogapp`调用。
   - **输入文件**：支持标准输入和文件列表。
   - **文件覆盖**：使用`-r`和`-w`选项处理不可写文件。
   - **全局设置**：通过`-D`选项设置全局变量。
   - **校验和输出**：使用`-c`选项生成校验和保护输出。
   - **持续集成**：使用`--check`选项检查文件是否需要更新。
   - **输出后缀**：使用`-s`选项为生成的行添加后缀。
   - **杂项选项**：支持编码、标记、删除生成器等选项。

8. **历史与反馈**：
   - **历史记录**：Cog的变更日志在单独的页面。
   - **用户反馈**：欢迎用户反馈使用中的成功或困难。

9. **相关工具**：
   - **其他实现**：如Argent（Ruby）、Precog（PHP）、PCG（Perl）等。
   - **阅读推荐**：Python成功故事和作者博客。
