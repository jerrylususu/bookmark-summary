# 聊聊自动化 PDF 渲染方案
- URL: https://roriri.one/2024/08/28/pdf-rendering/
- Added At: 2024-09-09 14:30:59

## TL;DR
文章总结了PDF自动生成方案，包括LaTeX、Web Stack和typst的优缺点及适用场景。通过typst的二次开发，提升了系统集成和资源加载效率，解决了特殊样式渲染问题。文章旨在为开发者提供PDF生成方案的参考。

## Summary
1. **背景与动机**：
   - **个人经历**：作者从大学时期开始关注自动化PDF生成，考研时因背单词需求研究过多种方案，最终因解决方案不佳而使用闭源工具。
   - **当前工具**：随着typst和开源工具链的发展，PDF生成的开发难度显著降低。
   - **文章目的**：总结当前PDF自动生成方案及其优缺点，记录个人探索过程，并分享找到的“标准答案”。

2. **已有方案**：
   - **LaTeX**：
     - **优点**：表现力强，适合纸媒设计和精细排版，字体排印控制精确。
     - **缺点**：发行版混乱，语法复杂且不易维护，客户端生成PDF时体积庞大且配置复杂。
     - **适用场景**：对印刷质量要求极高的项目，服务端生成PDF。
   - **Web Stack**：
     - **优点**：调试体验佳，入门难度低，适合复杂图表和插图的文档。
     - **缺点**：打印样式兼容性差，性能较差，难以实现高效并行渲染，依赖浏览器稳定性。
     - **适用场景**：需要复杂图表和插图的文档，服务端生成PDF。
   - **typst**：
     - **优点**：由Rust开发，渲染速度快，语法接近Markdown，易于学习和使用，与Rust集成良好。
     - **缺点**：生态系统不完善，缺乏高质量模板和最佳实践，渲染复杂图表和思维导图时存在局限性。
     - **适用场景**：需要快速生成PDF的项目，系统集成需求高的项目。

3. **typst二次开发**：
   - **API调用**：通过`typst-as-lib`封装，暴露直观的API，便于系统集成。
   - **资源加载**：使用`include_dir`将模板和资源文件打包到二进制文件中，确保工程“干净”。
   - **渲染工具**：通过`tinymist`实现自动刷新和代码跳转，提升调试体验。
   - **性能优化**：利用Rust的特性，实现高效的系统集成和资源加载。

4. **typst渲染问题**：
   - **特殊样式渲染**：typst的PDF渲染机制不完善，特殊格式图像和渐变色渲染时预览结果与实际输出有出入。
   - **解决方案**：输出SVG格式文档，用Chromium转换为单页PDF，再用`lopdf`合并。
   - **替代方案**：使用`librsvg`进行SVG渲染，避免浏览器依赖，提升渲染速度。

5. **总结**：
   - **方案对比**：详细分析了LaTeX、Web Stack和typst的优缺点及适用场景。
   - **最佳实践**：通过合理选择和组合不同技术栈，实现高效的PDF生成。
   - **未来展望**：希望本文能为开发者在选择和实现PDF生成方案时提供参考。
