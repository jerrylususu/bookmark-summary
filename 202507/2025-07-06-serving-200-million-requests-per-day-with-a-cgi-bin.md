# Serving 200 million requests per day with a cgi-bin
- URL: https://jacob.gold/posts/serving-200-million-requests-with-cgi-bin/
- Added At: 2025-07-06 05:22:24

## TL;DR


本文分析了CGI在动态网站中的发展。早期CGI因环境变量与独立进程特性，虽部署简单但硬件不足导致性能瓶颈；现代多核服务器让CGI多进程优势凸显，实测日均处理2亿请求、RPS达2700。Go语言结合SQLite的实例验证了CGI在轻量级场景的高效性（延迟<10ms），其零依赖、简洁架构仍适合小型系统开发。

## Summary


- 在2000年代，CGI程序用于动态网站开发，多用Perl或C编写。其机制包括：设置环境变量保存请求元数据、生成子进程执行程序、通过标准输入传递请求体、标准输出返回响应、错误日志记录。

- 每个CGI请求独立处理，结束后自动释放资源，确保稳定性。部署简易，仅需将程序放入`cgi-bin/`目录即可生效。

- 早期服务器硬件有限（1-2核，1-4G内存），Apache因每连接生成新进程导致内存占用高，最高并发不足100。轻量级CGI程序面临“拥抱死亡”问题（Slashdot效应），简单负载即可崩溃。

- 现代服务器多核处理能力提升（如384线程），CGI多进程特性能充分利用CPU资源。作者在16核AMD R3700X服务器测试发现，使用CGI日均可处理2亿+请求（2400+ RPS）。

- 性能测试数据：
  - **写入（Apache）**：10万次POST 请求用时40.5秒，RPS为2469，P99延迟约15ms。
  - **读取（Apache）**：10万次GET 请求用时51秒，RPS为1959，P99延迟约15.6ms。
  - **写入（Go自建服务器）**：RPS提升至2742，在16并发下耗时36.4秒，最低延迟2.98ms。
  - **读取（Go自建服务器）**：RPS达2470，P90延迟仅8ms，94.8%请求在<10ms内完成。

- 示例程序为简易留言板：用Go语言结合SQLite构建基础动态功能，具备HTML模板渲染、表单提交及数据查询，代码开源在GitHub。

- 尽管现代框架（如异步或线程池设计）更优，CGI仍能有效支持高并发场景。其零依赖、简单可靠的特点，在轻量级应用或小型系统中仍具开发价值。
