# TI-20250709-0001: IPv4 traffic failures for Techaro services | Anubis
- URL: https://anubis.techaro.lol/blog/incident/TI-20250709-0001/
- Added At: 2025-07-10 14:27:43
- [Link To Text](2025-07-10-ti-20250709-0001-ipv4-traffic-failures-for-techaro-services-anubis_raw.md)

## TL;DR


Techaro于2025年7月9日因Vultr多伦多区域上游供应商IPv4 BGP会话故障，导致相关服务中断约2.5小时，IPv6未受影响。问题经服务商修复后恢复。事件促使Techaro计划建立跨云服务商的状态页面及独立IPv4/IPv6健康检查，并优化服务依赖关系以提升稳定性。（99字）

## Summary


### 事件概述  
Techaro的IPv4流量在2025年7月9日发生故障，导致相关服务中断。该问题源于Vultr多伦多区域上游供应商的IPv4 BGP会话不稳定，而IPv6流量未受影响。事件持续约2.5小时，最终由服务提供商修复BGP问题解决。

---

### 时间线  
所有事件发生于2025年7月9日（UTC时间）：  
- **12:32**：Uptime Kuma检测到同一集群的其他IPv4网站超时。  
  - **12:33**：Thoth生产端点的gRPC健康检查失败，IPv6流量正常。  
  - **12:35**：开始调查，并在Bluesky发布故障公告，影响涉及Techaro个人博客。  
  - **12:39**：发现Nginx-ingress日志显示IPv6流量正常但IPv4突然中断，向托管商提交工单。  
  - **12:41/12:46/14:07/14:10**：IPv4流量短暂恢复后多次中断，间隔约5-10分钟。  
  - **12:48**：托管商首次回复工单。  
  - **12:57**：要求托管商重启负载均衡器。  
  - **13:00**：响应者因会议暂停主动处理，依赖监控软件更新。  
  - **13:20**：返回后继续监控并准备报告。  
  - **13:34**：IPv4流量重新出现在ingress-nginx日志中。  
  - **13:35**：所有服务健康检查恢复，转为监控状态。  
  - **13:48**：事件关闭。  
  - **14:07**：问题再次出现，确认为上游供应商BGP故障。  
  - **14:10**：IPv4流量中断后短暂恢复，事件重启。  
  - **14:18**：流量再次恢复，转为监控状态。  
  - **14:40**：事件最终关闭。  

---

### 受影响服务  
| 服务名称 | IPv4影响 | IPv6影响 |  
| --- | --- | --- |  
| Anubis Docs | 连接超时 | 无 |  
| Thoth | 连接超时 | 无 |  
| 同集群的其他网站 | 连接超时 | 无 |  

---

### 根本原因  
- **技术架构**：Techaro使用Vultr VKE托管Kubernetes集群，依赖Vultr提供的负载均衡器路由流量至公网。IPv4与IPv6为独立网络，故障仅影响IPv4。  
- **直接原因**：Vultr多伦多区域上游供应商的IPv4 BGP会话波动，导致公网IPv4流量无法到达集群。  
- **无法控制因素**：Techaro仅管理集群内部，BGP路由依赖外部服务商，需等待其修复。  

---

### 幸运因素  
1. Uptime Kuma运行于IPv4-only网络，迅速发现IPv4故障。  
2. ingress-nginx日志记录了客户端IP，便于排查问题根源。  

---

### 改进措施  
1. **不更换服务商**：单次事件未达迁移服务商标准，暂不考虑。  
2. **独立状态页**：建立托管于其他云服务商的状态页面（任务号：`TecharoHQ/TODO#6`）。  
3. **独立健康检查**：新增IPv4和IPv6流量的健康检查（任务号：`TecharoHQ/TODO#7`）。  
4. **移除依赖关系**：取消Anubis在启用Thoth时需等待Thoth健康检查启动的要求（GitHub Pull Request #794）。  

---

注：Techaro通过公开透明的故障报告，践行“坦诚沟通”的承诺，以技术文档形式复盘事件细节。
