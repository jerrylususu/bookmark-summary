# How to build secure and scalable remote MCP servers
- URL: https://github.blog/ai-and-ml/generative-ai/how-to-build-secure-and-scalable-remote-mcp-servers/
- Added At: 2025-07-26 10:26:32
- [Link To Text](2025-07-26-how-to-build-secure-and-scalable-remote-mcp-servers_raw.md)

## TL;DR


MCP是连接AI模型与外部资源的安全协议，核心需保障安全与扩展性。其通过OAuth 2.1授权机制（含动态注册、PKCE验证）、严格权限隔离和数据隔离防范攻击；采用AI网关处理流量与安全策略；生产环境需密钥管理服务和可观测性工具，平衡安全与性能。（99字）

## Summary


MCP（Model Context Protocol）是一种标准化连接AI模型与外部工具和数据源的协议。由于其涉及大量敏感资源且存在被攻击风险，安全性与扩展性是构建MCP服务器的核心考量。

**安全性关键要点：**  
- **威胁分析**：MCP服务器作为连接AI与企业资源的桥梁，若遭攻击可能导致数据泄露及系统操控。需防范如混淆代理、令牌传递漏洞和会话劫持等风险。  
- **OAuth 2.1授权机制**：  
  - **授权服务器发现**：通过`WWW-Authenticate`头提供元数据端点，引导客户端自动发现授权服务器。  
  - **动态客户端注册**：支持自动注册机制，减少手动配置需求。  
  - **资源指示符**：确保令牌仅绑定特定服务器，防止跨服务器复用。  
- **认证流程**：共8步骤，包含发现阶段、客户端注册、PKCE代码交换及用户授权等，所有请求需携带Bearer令牌。  

**实现细节：**  
- **PRM端点**：MCP服务器需实现`/.well-known/oauth-protected-resource`以声明支持的授权范围。  
- **令牌验证**：需检查签名、失效期及受众（aud）是否指定当前服务器，推荐使用开源库（如PyJWT）简化实现。  
- **错误处理**：返回`401`或`403`状态码，并附带OAuth认证头。  

**多用户场景安全要求：**  
- **身份验证与授权**：提取用户ID并严格验证，杜绝盲目信任令牌声明。  
- **权限隔离**：基于用户角色设置最小权限，防止越权访问。  
- **数据隔离**：查询与日志操作需严格限制在当前用户范围，避免泄露。  

**扩展性与架构设计：**  
- **AI网关作用**：集中处理流量管理、协议转换（如版本兼容）、安全策略（如限流、缓存）及基础安全防护（如安全头注入）。  
- **智能策略配置**：包括速率限制、电路断路器、请求缓存，以应对突发流量和微服务依赖。  

**生产环境最佳实践：**  
- **机密管理**：  
  - 避免环境变量存储密钥，改用Azure Key Vault等专用服务。  
  - 采用“工作负载身份”消除静态凭证，如云平台身份验证直接访问密钥库。  
- **可观测性**：  
  - 结构化日志需携带唯一追踪ID，支持全链路追踪。  
  - 结合分布式追踪（如OpenTelemetry）与关键指标（延迟、错误率），配置告警与可视化仪表盘。  

**总结：**  
构建MCP服务器需以安全为基石，遵循协议规范并利用云原生安全工具。从OAuth集成到密钥管理，再到可观测性体系，安全设计需贯穿架构始终，确保在扩展性与安全性间取得平衡。
