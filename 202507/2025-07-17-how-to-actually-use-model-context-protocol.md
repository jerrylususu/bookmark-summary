# How to actually use Model Context Protocol
- URL: https://www.seangoedecke.com/how-to-actually-use-mcp/
- Added At: 2025-07-17 13:59:28
- [Link To Text](2025-07-17-how-to-actually-use-model-context-protocol_raw.md)

## TL;DR


本文介绍了在代码中实现Model Context Protocol（MCP）连接工具服务器的6个关键步骤，包括库导入、握手认证、工具格式转换及循环推理交互，并通过GitHub示例展示安全措施（临时令牌、只读限制）。当前需手动处理底层逻辑，建议开发更简化的封装工具。文章指出MCP生态尚不成熟，提供的开源示例可供参考。（99字）

## Summary


本文介绍了如何在代码中实际使用Model Context Protocol (MCP)连接工具服务器的具体步骤，指出尽管MCP工具在IDE中广泛应用，但缺乏针对代码实现的直接指导。关键步骤包括：  
1. **导入MCP库**：使用对应语言的MCP客户端库。  
2. **握手与获取工具列表**：通过HTTP协议与MCP服务器建立连接，获取可用工具及其描述。  
3. **工具格式转换**：将MCP工具定义转换为目标LLM（如Azure）支持的格式。  
4. **发起LLM推理请求**：在API调用中包含转换后的工具列表。  
5. **处理工具调用**：若LLM响应包含工具调用请求，则将其转发给MCP服务器执行，并获取结果。  
6. **循环迭代**：将工具执行结果反馈给LLM，形成“推理-调用工具-反馈结果-继续推理”的循环，直至模型不再调用工具或达到最大循环次数。  

实践示例中，作者以GitHub MCP服务器为例，展示了如何通过SDK实现连接、令牌认证及工具处理，并强调了**安全要点**：  
- 使用用户作用域的临时令牌，避免暴露高权限令牌。  
- 限制工具为只读（如通过`X-MCP-Readonly`头）。  

代码实现中，通过**循环结构**支持多步骤交互（如先获取PR列表，再进一步操作），但流程较为繁琐，当前需手动处理许多底层逻辑。作者建议未来工具应简化此过程，例如提供封装好的客户端或工具转换函数。  

最后指出当前MCP生态工具仍不成熟，需开发者自行集成，本文分享的开源示例（如GitHub Action中的实现）可作为参考。
