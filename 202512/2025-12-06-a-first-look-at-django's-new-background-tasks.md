# A first look at Django's new background tasks
- URL: https://roam.be/notes/2025/a-first-look-at-djangos-new-background-tasks/
- Added At: 2025-12-06 15:20:51
- Tags: #read #python

## TL;DR
Django 6.0 推出内置任务框架 `django.tasks`，提供统一 API 标准，便于集成多种后端。支持异步任务定义与排队，但功能精简，缺少重试、编排等高级特性，适用于简单场景，复杂需求仍需 Celery 等工具。

## Summary
Django 6.0 引入了内置后台任务框架 `django.tasks`，但并非旨在取代 Celery 等成熟方案。以下是关键总结：

### 框架定位与特点
- **核心目标**：提供统一的API标准，便于不同任务队列实现（如数据库、Redis）集成，而非内置完整工作器机制。
- **设计原则**：通过 `@task` 装饰器定义任务，强制使用 `enqueue` 方法排队，避免误同步执行。支持优先级、队列名等基础配置，但功能精简，不包含重试、复杂编排等高级特性。

### 实际应用示例
- **项目演示**：基于 `ntfy.sh` 发送通知的任务，展示从定义、排队到结果查询的全流程。
- **核心组件**：
  - **任务定义**：用 `@task` 包装函数，通过 `enqueue` 触发异步执行。
  - **结果处理**：利用 `get_result` 查询状态，结合 HTMX 实现前端轮询更新。
  - **自定义后端**：示例实现基于数据库的后端（`DatabaseBackend`），包含模型设计、任务声明、重试逻辑及简单工作器。

### 技术细节
- **后端实现**：需自定义 `enqueue` 和 `get_result` 方法，存储任务数据（如参数、状态、重试次数）。示例使用数据库模型管理任务生命周期，支持退避重试（如 `backoff_factor`）。
- **工作器机制**：通过轮询数据库获取待处理任务，使用原子操作声明任务，防止重复执行。工作器流程为：检查任务→声明→处理→更新状态。
- **局限性**：无内置重试、复杂任务流支持；高级功能（如信号、事务处理）需自行扩展。

### 生态与展望
- **现状**：Django 官方仅提供 `ImmediateBackend`（立即执行）和 `DummyBackend`（空执行），实际需依赖第三方后端。
- **未来发展**：参考实现（如 `django-tasks` 库）已提供更完整的工作器，预计社区将涌现更多适配器，覆盖80%常见用例。但复杂场景（如任务编排）仍需 Celery 等专业工具。

总之，`django.tasks` 是迈向标准化的重要一步，以简洁API降低入门门槛，但高级需求需结合外部解决方案。
