# Metastable failures in the wild
- URL: http://muratbuffalo.blogspot.com/2023/09/metastable-failures-in-wild.html
- Added At: 2025-02-22 10:18:35
- [Link To Text](2025-02-22-metastable-failures-in-the-wild_raw.md)

## TL;DR
文章探讨了亚稳态故障的形成及其在现实系统中的表现，提出了四种分类，并强调打破持续效应的重要性，以恢复系统稳定。

## Summary
1. **文章来源**：
   - 文章标题：Metastable failures in the wild
   - 发布时间：2023年9月12日
   - 文章链接：[OSDI'22论文](https://www.usenix.org/system/files/osdi22-huang-lexiang.pdf)

2. **文章概述**：
   - 文章讨论了“亚稳态故障”（metastable failures）的概念及其在现实系统中的表现。
   - 作者通过对600个公开的事后分析报告进行研究，识别出21个亚稳态故障案例。
   - 文章提出了四种亚稳态故障的分类，并解释了这些故障如何在不稳定的系统中持续存在。

3. **亚稳态故障的概念**：
   - 定义：亚稳态故障是指系统在移除触发故障的事件后，仍然处于过载状态，无法恢复到正常状态。
   - 原因：系统针对常见情况进行的优化导致了持续的工作放大（work amplification）。
   - 物理学中的亚稳态概念：亚稳态是指系统在不稳定状态下无法回到稳定状态，类似于物理学中的亚稳态。

4. **亚稳态故障的分类**：
   - 文章提出了四种亚稳态故障的分类，基于两个参数：负载（load）和容量（capacity）。
   - 四种分类：
     - **左上角**：负载峰值触发，超时请求重试导致负载放大，持续过载。
     - **右上角**：容量下降触发，工作负载增加导致系统无法恢复（如Raft协议中的主节点故障）。
     - **左下角**：负载增加触发，容量下降导致系统性能下降（如Twitter中的垃圾回收机制）。
     - **右下角**：容量下降（如缓存失效）触发，数据库过载导致无法恢复（如缓存穿透问题）。

5. **实验与验证**：
   - 作者通过控制触发事件的持续时间和大小，展示了这些故障的持续效应。
   - 实验结果表明，系统存在稳定的、脆弱的和亚稳态的区域，且这些区域之间的界限非常狭窄。
   - 代码开源：[GitHub代码库](https://github.com/lexiangh/Metastability)

6. **现实世界中的亚稳态故障**：
   - 文章分析了600个公开的事后分析报告，识别出21个亚稳态故障案例。
   - 故障触发原因：
     - 35%由负载峰值触发。
     - 45%由错误的配置或代码部署触发。
   - 持续效应：
     - 超过50%的案例中，重试导致的负载增加是主要持续效应。
     - 其他因素包括错误处理的开销、锁争用和领导者选举的性能下降。

7. **恢复策略**：
   - 打破持续效应的循环是恢复的关键。
   - 恢复方法包括直接的负载削减、限流、请求丢弃、调整工作负载参数，或通过重启和策略变更间接削减负载。

8. **作者的个人见解**：
   - **脆弱区域的风险**：作者认为处于脆弱区域并不一定是坏事，但需要快速感知并处理问题，避免系统进入亚稳态状态。
   - **避免自拒绝服务**：系统设计时应避免不必要的工作放大，特别是重试机制可能导致系统过载。
   - **优化与亚稳态**：过度优化某些部分可能导致系统在异常情况下无法恢复。

9. **DynamoDB的案例**：
   - DynamoDB通过优先考虑可预测性而不是绝对效率来提高系统稳定性。
   - DynamoDB的设计避免了在缓存失效时导致系统崩溃的“双峰行为”。

10. **自稳定与亚稳态**：
    - 自稳定（self-stabilization）是指系统从任何故障状态恢复到正常状态的能力。
    - 自稳定理论主要关注状态空间的破坏，而不关注性能下降，因此不能直接应用于亚稳态故障的解决。

11. **静态稳定性与亚稳态**：
    - 静态稳定性是指系统在没有控制平面协调的情况下，能够通过预定义的容错行为继续运行。
    - 静态稳定性可能有助于防止系统从脆弱区域滑向亚稳态区域。
